<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#E8845A">
  <meta name="description" content="å¤§åˆ‡ãªå‘½ã‚’ã€æ¬¡ã¸ã¤ãªãã€‚ãƒšãƒƒãƒˆã®ã‚‚ã—ã‚‚ã«å‚™ãˆã‚‹ã‚¢ãƒ—ãƒª">
  <title>Tasuki ã‚¿ã‚¹ã‚­ - å¤§åˆ‡ãªå‘½ã‚’ã€æ¬¡ã¸ã¤ãªãã€‚</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --primary: #E8845A;
      --primary-light: #F5A07A;
      --primary-dark: #C86A40;
      --accent: #F5E6D3;
      --text: #3D2B1F;
      --text-light: #8B6F5E;
      --white: #FFFFFF;
      --bg: #FDF8F4;
      --card: #FFFFFF;
      --border: #EDD9C8;
      --danger: #E53E3E;
      --success: #38A169;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: var(--bg);
      color: var(--text);
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      padding-bottom: 80px;
    }

    .header {
      background: var(--white);
      padding: 16px 20px;
      text-align: center;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-center { flex: 1; text-align: center; }
    .logo-text { font-family: 'Poppins', sans-serif; font-size: 20px; font-weight: 700; color: var(--primary); }
    .logo-text span { font-family: 'Noto Sans JP', sans-serif; font-size: 12px; color: var(--text-light); margin-left: 4px; }
    .tagline { font-size: 11px; color: var(--text-light); }

    .logout-btn {
      font-size: 11px;
      color: var(--text-light);
      background: none;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 4px 10px;
      cursor: pointer;
      font-family: 'Noto Sans JP', sans-serif;
    }

    /* Auth Screen */
    .auth-screen {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 24px;
      background: linear-gradient(160deg, #FDF8F4 0%, #F5E6D3 100%);
    }

    .auth-logo { font-size: 60px; margin-bottom: 16px; }
    .auth-title { font-family: 'Poppins', sans-serif; font-size: 28px; font-weight: 700; color: var(--primary); margin-bottom: 4px; }
    .auth-tagline { font-size: 13px; color: var(--text-light); margin-bottom: 40px; }

    .auth-card {
      background: var(--white);
      border-radius: 24px;
      padding: 32px 24px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 8px 32px rgba(61,43,31,0.1);
      border: 1px solid var(--border);
    }

    .auth-tabs {
      display: flex;
      background: var(--accent);
      border-radius: 12px;
      padding: 4px;
      margin-bottom: 24px;
      gap: 4px;
    }

    .auth-tab {
      flex: 1;
      padding: 10px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 700;
      text-align: center;
      cursor: pointer;
      border: none;
      background: none;
      font-family: 'Noto Sans JP', sans-serif;
      color: var(--text-light);
      transition: all 0.2s;
    }

    .auth-tab.active { background: var(--white); color: var(--primary); }

    .form-group { margin-bottom: 16px; }
    .form-label { font-size: 13px; font-weight: 700; color: var(--text); margin-bottom: 6px; display: block; }

    .form-input {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 14px;
      font-family: 'Noto Sans JP', sans-serif;
      background: var(--white);
      color: var(--text);
      outline: none;
      transition: border-color 0.2s;
    }

    .form-input:focus { border-color: var(--primary); }

    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 14px;
      width: 100%;
      font-size: 15px;
      font-weight: 700;
      font-family: 'Noto Sans JP', sans-serif;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 8px;
    }

    .btn-primary:active { transform: scale(0.98); }
    .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }

    .btn-secondary {
      background: var(--white);
      color: var(--primary);
      border: 2px solid var(--primary);
      border-radius: 12px;
      padding: 12px;
      width: 100%;
      font-size: 14px;
      font-weight: 700;
      font-family: 'Noto Sans JP', sans-serif;
      cursor: pointer;
      margin-top: 8px;
    }

    .auth-msg { font-size: 13px; text-align: center; margin-top: 12px; padding: 10px; border-radius: 8px; }
    .auth-msg.error { background: #FFF5F5; color: var(--danger); }
    .auth-msg.success { background: #F0FFF4; color: var(--success); }

    /* App */
    .app-screen { display: none; }
    .app-screen.active { display: block; }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 480px;
      background: var(--white);
      border-top: 1px solid var(--border);
      display: flex;
      z-index: 100;
    }

    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px 4px;
      cursor: pointer;
      border: none;
      background: none;
      color: var(--text-light);
      font-size: 10px;
      font-family: 'Noto Sans JP', sans-serif;
      transition: color 0.2s;
    }

    .nav-item.active { color: var(--primary); }
    .nav-item .nav-icon { font-size: 20px; margin-bottom: 2px; }

    .page { display: none; padding: 16px; }
    .page.active { display: block; }

    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid var(--border);
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }

    .card-title { font-size: 14px; font-weight: 700; color: var(--text); margin-bottom: 12px; }

    .sos-btn {
      background: linear-gradient(135deg, #E53E3E, #C53030);
      color: white;
      border: none;
      border-radius: 16px;
      padding: 18px;
      width: 100%;
      font-size: 18px;
      font-weight: 700;
      font-family: 'Noto Sans JP', sans-serif;
      cursor: pointer;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 16px rgba(229,62,62,0.3);
    }

    .alert-banner {
      background: #FFF5F5;
      border: 1px solid #FED7D7;
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 12px;
      font-size: 13px;
      color: var(--danger);
    }

    .quick-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }

    .quick-item {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quick-item:active { background: var(--accent); }
    .quick-item .icon { font-size: 24px; margin-bottom: 6px; }
    .quick-item .label { font-size: 12px; font-weight: 700; }
    .quick-item .sub { font-size: 10px; color: var(--text-light); margin-top: 2px; }

    .situation-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .situation-card:active { background: var(--accent); }
    .sit-icon { font-size: 28px; }
    .sit-text { font-size: 15px; font-weight: 500; }

    .solution-item { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px; font-size: 13px; }
    .solution-num { background: var(--primary); color: white; width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; flex-shrink: 0; }

    .org-item { background: var(--white); border-radius: 10px; padding: 10px 12px; margin-bottom: 6px; font-size: 12px; }
    .org-name { font-weight: 700; }
    .org-link { color: var(--primary); text-decoration: none; font-size: 11px; }

    .action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px; }
    .action-btn { background: var(--white); border: 1px solid var(--primary); color: var(--primary); border-radius: 10px; padding: 10px; font-size: 12px; font-weight: 700; cursor: pointer; font-family: 'Noto Sans JP', sans-serif; }

    .form-select { width: 100%; padding: 12px 14px; border: 1px solid var(--border); border-radius: 10px; font-size: 14px; font-family: 'Noto Sans JP', sans-serif; background: var(--white); color: var(--text); outline: none; }

    textarea.form-input { min-height: 80px; resize: vertical; }

    .icon-selector { display: flex; gap: 8px; }
    .icon-opt { flex: 1; padding: 10px 6px; border: 2px solid var(--border); border-radius: 10px; text-align: center; cursor: pointer; font-size: 11px; transition: all 0.2s; }
    .icon-opt .opt-icon { font-size: 20px; display: block; margin-bottom: 2px; }
    .icon-opt.selected { border-color: var(--primary); background: var(--accent); }

    .timeline-item { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 14px; margin-bottom: 10px; }
    .timeline-date { font-size: 12px; color: var(--text-light); margin-bottom: 6px; }
    .health-icons { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 6px; }
    .health-badge { font-size: 11px; padding: 3px 8px; border-radius: 20px; background: var(--accent); }
    .weight-display { font-size: 20px; font-weight: 700; color: var(--primary); }
    .weight-change { font-size: 12px; padding: 2px 8px; border-radius: 20px; }
    .weight-change.up { background: #FFF5F5; color: var(--danger); }
    .weight-change.down { background: #F0FFF4; color: var(--success); }

    .chart-container { position: relative; height: 200px; margin: 12px 0; }
    .chart-tabs { display: flex; gap: 6px; margin-bottom: 12px; }
    .chart-tab { padding: 6px 14px; border-radius: 20px; font-size: 12px; border: 1px solid var(--border); cursor: pointer; background: var(--white); font-family: 'Noto Sans JP', sans-serif; }
    .chart-tab.active { background: var(--primary); color: white; border-color: var(--primary); }

    .vaccine-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--accent); border-radius: 10px; margin-bottom: 8px; }
    .vaccine-name { font-size: 13px; font-weight: 700; }
    .vaccine-date { font-size: 11px; color: var(--text-light); }
    .vaccine-alert { background: #FFF5F5; border: 1px solid #FED7D7; border-radius: 20px; padding: 3px 10px; font-size: 11px; color: var(--danger); font-weight: 700; }
    .vaccine-ok { background: #F0FFF4; border-radius: 20px; padding: 3px 10px; font-size: 11px; color: var(--success); }

    .pet-avatar { width: 80px; height: 80px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-size: 36px; margin: 0 auto 12px; border: 3px solid var(--primary); overflow: hidden; }
    .pet-avatar img { width: 100%; height: 100%; object-fit: cover; }

    .note-section { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 16px; margin-bottom: 12px; }
    .note-section-title { font-size: 14px; font-weight: 700; color: var(--primary); margin-bottom: 10px; }

    .support-category { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 14px; }
    .cat-btn { padding: 6px 14px; border-radius: 20px; font-size: 12px; border: 1px solid var(--border); cursor: pointer; background: var(--white); font-family: 'Noto Sans JP', sans-serif; }
    .cat-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

    .support-card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 14px; margin-bottom: 10px; }
    .support-name { font-size: 14px; font-weight: 700; margin-bottom: 4px; }
    .support-area { font-size: 11px; color: var(--text-light); margin-bottom: 8px; }
    .link-btn { padding: 6px 12px; border-radius: 8px; font-size: 12px; border: 1px solid var(--primary); color: var(--primary); background: var(--white); cursor: pointer; text-decoration: none; display: inline-block; }

    .sim-result { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border-radius: 14px; padding: 20px; text-align: center; margin-bottom: 12px; }
    .sim-amount { font-size: 32px; font-weight: 700; font-family: 'Poppins', sans-serif; }
    .sim-label { font-size: 12px; opacity: 0.9; margin-bottom: 4px; }
    .sim-breakdown { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 14px; }
    .sim-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 13px; }
    .sim-row:last-child { border-bottom: none; }

    .check-item { display: flex; align-items: flex-start; gap: 12px; padding: 12px; background: var(--card); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 8px; cursor: pointer; }
    .check-box { width: 22px; height: 22px; border: 2px solid var(--border); border-radius: 6px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
    .check-box.checked { background: var(--primary); border-color: var(--primary); color: white; font-size: 14px; font-weight: 700; }
    .check-text { font-size: 13px; font-weight: 700; }
    .check-sub { font-size: 11px; color: var(--text-light); margin-top: 2px; }

    .progress-bar { background: var(--border); border-radius: 20px; height: 8px; margin: 10px 0; overflow: hidden; }
    .progress-fill { background: var(--primary); height: 100%; border-radius: 20px; transition: width 0.5s; }

    .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 200; align-items: flex-end; }
    .modal-overlay.active { display: flex; }
    .modal { background: var(--white); border-radius: 24px 24px 0 0; padding: 24px 20px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; }
    .modal-title { font-size: 18px; font-weight: 700; margin-bottom: 16px; text-align: center; }
    .modal-close { position: absolute; top: 16px; right: 20px; font-size: 24px; cursor: pointer; color: var(--text-light); background: none; border: none; }

    .page-title { font-size: 20px; font-weight: 700; margin-bottom: 16px; }
    .page-subtitle { font-size: 13px; color: var(--text-light); margin-bottom: 16px; }

    .plan-badge { background: linear-gradient(135deg, #667eea, #764ba2); color: white; font-size: 10px; padding: 2px 8px; border-radius: 20px; font-weight: 700; margin-left: 6px; }

    .sub-tabs { display: flex; background: var(--accent); border-radius: 12px; padding: 4px; margin-bottom: 16px; gap: 4px; }
    .sub-tab { flex: 1; padding: 8px; border-radius: 10px; font-size: 12px; font-weight: 700; text-align: center; cursor: pointer; border: none; background: none; font-family: 'Noto Sans JP', sans-serif; color: var(--text-light); }
    .sub-tab.active { background: var(--white); color: var(--primary); }

    .sub-page { display: none; }
    .sub-page.active { display: block; }

    .empty-state { text-align: center; padding: 40px 20px; color: var(--text-light); }
    .empty-state .empty-icon { font-size: 48px; margin-bottom: 12px; }
    .empty-state p { font-size: 14px; }

    .photo-upload { border: 2px dashed var(--border); border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; color: var(--text-light); font-size: 13px; }
    .photo-preview { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    .photo-thumb { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; }

    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .add-btn { background: var(--primary); color: white; border: none; border-radius: 8px; padding: 6px 14px; font-size: 12px; font-weight: 700; cursor: pointer; font-family: 'Noto Sans JP', sans-serif; }

    .loading { text-align: center; padding: 20px; color: var(--text-light); font-size: 14px; }

    .user-plan-badge { font-size: 11px; padding: 2px 10px; border-radius: 20px; font-weight: 700; }
    .plan-free { background: var(--accent); color: var(--text-light); }
    .plan-standard { background: #EBF8FF; color: #2B6CB0; }
    .plan-premium { background: #FAF5FF; color: #6B46C1; }
  </style>
</head>
<body>

<!-- Auth Screen -->
<div id="auth-screen" class="auth-screen">
  <div class="auth-logo">ğŸ¾</div>
  <div class="auth-title">Tasuki ã‚¿ã‚¹ã‚­</div>
  <div class="auth-tagline">å¤§åˆ‡ãªå‘½ã‚’ã€æ¬¡ã¸ã¤ãªãã€‚</div>

  <div class="auth-card">
    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchAuthTab('login')">ãƒ­ã‚°ã‚¤ãƒ³</button>
      <button class="auth-tab" onclick="switchAuthTab('signup')">æ–°è¦ç™»éŒ²</button>
    </div>

    <div id="login-form">
      <div class="form-group">
        <label class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
        <input type="email" class="form-input" id="login-email" placeholder="example@email.com">
      </div>
      <div class="form-group">
        <label class="form-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
        <input type="password" class="form-input" id="login-password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
      </div>
      <button class="btn-primary" id="login-btn" onclick="handleLogin()">ğŸ¾ ãƒ­ã‚°ã‚¤ãƒ³</button>
    </div>

    <div id="signup-form" style="display:none">
      <div class="form-group">
        <label class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
        <input type="email" class="form-input" id="signup-email" placeholder="example@email.com">
      </div>
      <div class="form-group">
        <label class="form-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ6æ–‡å­—ä»¥ä¸Šï¼‰</label>
        <input type="password" class="form-input" id="signup-password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
      </div>
      <button class="btn-primary" id="signup-btn" onclick="handleSignup()">ğŸ¾ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹</button>
    </div>

    <div id="auth-message"></div>
  </div>
</div>

<!-- App Screen -->
<div id="app-screen" class="app-screen">

  <!-- Header -->
  <div class="header">
    <div style="width:60px"></div>
    <div class="header-center">
      <div class="logo-text">Tasuki <span>ã‚¿ã‚¹ã‚­</span></div>
      <div class="tagline">å¤§åˆ‡ãªå‘½ã‚’ã€æ¬¡ã¸ã¤ãªãã€‚</div>
    </div>
    <button class="logout-btn" onclick="handleLogout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
  </div>

  <!-- Pages -->
  <div class="page active" id="page-home">
    <div id="alert-area"></div>
    <button class="sos-btn" onclick="switchPage('sos')">âš ï¸ SOS ç·Šæ€¥ç›¸è«‡</button>
    <div class="card" id="pet-summary">
      <div class="card-title">ãƒšãƒƒãƒˆã®æƒ…å ±</div>
      <div id="pet-summary-content">
        <div style="text-align:center;padding:12px;color:var(--text-light);font-size:13px;cursor:pointer" onclick="switchPage('pet')">
          ãƒšãƒƒãƒˆæƒ…å ±ã‚’ç™»éŒ²ã—ã¾ã—ã‚‡ã† â†’
        </div>
      </div>
    </div>
    <div class="quick-grid">
      <div class="quick-item" onclick="switchPage('health')"><div class="icon">â¤ï¸</div><div class="label">å¥åº·è¨˜éŒ²ã‚’ã¤ã‘ã‚‹</div><div class="sub">æ—¥ã€…ã®ä½“èª¿ç®¡ç†</div></div>
      <div class="quick-item" onclick="switchPage('note')"><div class="icon">ğŸ“–</div><div class="label">ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆã‚’æ›¸ã</div><div class="sub">å¤§åˆ‡ãªæƒ³ã„ã‚’æ®‹ã™</div></div>
      <div class="quick-item" onclick="switchPage('pet')"><div class="icon">ğŸ¶</div><div class="label">ãƒšãƒƒãƒˆæƒ…å ±ã‚’ç·¨é›†</div><div class="sub">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†</div></div>
      <div class="quick-item" onclick="switchPage('support')"><div class="icon">ğŸ”</div><div class="label">ã‚µãƒãƒ¼ãƒˆã‚’æ¢ã™</div><div class="sub">æ”¯æ´æƒ…å ±ãƒ»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div></div>
    </div>
  </div>

  <div class="page" id="page-sos">
    <div class="page-title">SOSç›¸è«‡</div>
    <div class="page-subtitle">é£¼ã„ç¶šã‘ã‚‹ã“ã¨ãŒä¸å®‰ã§ã™ã‹ï¼Ÿã¾ãšç›¸è«‡ã‚’ã€‚</div>
    <div class="situation-card" onclick="showSolution('moving')"><span class="sit-icon">ğŸ </span><span class="sit-text">å¼•è¶Šã—å…ˆãŒãƒšãƒƒãƒˆä¸å¯</span></div>
    <div class="situation-card" onclick="showSolution('money')"><span class="sit-icon">ğŸ’°</span><span class="sit-text">çµŒæ¸ˆçš„ã«è‹¦ã—ããªã£ãŸ</span></div>
    <div class="situation-card" onclick="showSolution('allergy')"><span class="sit-icon">ğŸ¤§</span><span class="sit-text">å®¶æ—ãŒã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã«ãªã£ãŸ</span></div>
    <div class="situation-card" onclick="showSolution('hospital')"><span class="sit-icon">ğŸ¥</span><span class="sit-text">å…¥é™¢ãƒ»ä»‹è­·ãŒå¿…è¦ã«ãªã£ãŸ</span></div>
    <div class="situation-card" onclick="showSolution('baby')"><span class="sit-icon">ğŸ‘¶</span><span class="sit-text">å‡ºç”£ãƒ»è‚²å…ã§æ‰‹ãŒå›ã‚‰ãªã„</span></div>
    <div class="situation-card" onclick="showSolution('different')"><span class="sit-icon">ğŸ˜”</span><span class="sit-text">æ€ã£ã¦ã„ãŸé£¼è‚²ã¨é•ã£ãŸ</span></div>
    <div class="situation-card" onclick="showSolution('other')"><span class="sit-icon">â“</span><span class="sit-text">ãã®ä»–</span></div>
    <div id="solution-area"></div>
  </div>

  <div class="page" id="page-pet">
    <div class="page-title">ãƒšãƒƒãƒˆæƒ…å ±</div>
    <div class="card">
      <div class="pet-avatar" id="pet-avatar-display">ğŸ¶</div>
      <div class="form-group">
        <label class="form-label">ğŸ“· å†™çœŸ</label>
        <div class="photo-upload" onclick="document.getElementById('pet-photo-input').click()">ã‚¿ãƒƒãƒ—ã—ã¦å†™çœŸã‚’è¿½åŠ <input type="file" id="pet-photo-input" accept="image/*" style="display:none" onchange="setPetPhoto(event)"></div>
      </div>
      <div class="form-group"><label class="form-label">åå‰ *</label><input type="text" class="form-input" id="pet-name" placeholder="ä¾‹ï¼šãƒãƒ"></div>
      <div class="form-group"><label class="form-label">ç¨®é¡</label><select class="form-select" id="pet-species"><option value="">é¸æŠ</option><option value="dog">çŠ¬</option><option value="cat">çŒ«</option><option value="other">ãã®ä»–</option></select></div>
      <div class="form-group"><label class="form-label">çŠ¬ç¨®ãƒ»çŒ«ç¨®</label><input type="text" class="form-input" id="pet-breed" placeholder="ä¾‹ï¼šæŸ´çŠ¬"></div>
      <div class="form-group"><label class="form-label">å¹´é½¢</label><input type="number" class="form-input" id="pet-age" placeholder="ä¾‹ï¼š3"></div>
      <div class="form-group"><label class="form-label">æ€§åˆ¥</label><select class="form-select" id="pet-gender"><option value="">é¸æŠ</option><option value="male">ã‚ªã‚¹</option><option value="female">ãƒ¡ã‚¹</option></select></div>
      <div class="form-group"><label class="form-label">æ€§æ ¼ãƒ»ç‰¹å¾´</label><textarea class="form-input" id="pet-personality" placeholder="ä¾‹ï¼šäººæ‡ã£ã“ã„ã€æ•£æ­©ãŒå¤§å¥½ã"></textarea></div>
      <div class="form-group"><label class="form-label">å¥½ããªé£Ÿã¹ç‰©</label><input type="text" class="form-input" id="pet-food" placeholder="ä¾‹ï¼šã•ã•ã¿"></div>
      <div class="form-group"><label class="form-label">è‹¦æ‰‹ãªã‚‚ã®</label><input type="text" class="form-input" id="pet-fears" placeholder="ä¾‹ï¼šé›·"></div>
      <div class="form-group"><label class="form-label">æ—¢å¾€æ­´ãƒ»ç—…æ°—</label><textarea class="form-input" id="pet-medical" placeholder="ä¾‹ï¼šã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æ€§çš®è†šç‚"></textarea></div>
      <div class="form-group"><label class="form-label">ç¾åœ¨ã®è–¬</label><input type="text" class="form-input" id="pet-meds" placeholder="ä¾‹ï¼šã‚¢ãƒã‚­ãƒ«éŒ ï¼ˆ1æ—¥1å›ï¼‰"></div>
      <div class="form-group"><label class="form-label">ãƒã‚¤ã‚¯ãƒ­ãƒãƒƒãƒ—ç•ªå·</label><input type="text" class="form-input" id="pet-chip" placeholder="15æ¡ã®ç•ªå·"></div>
      <div class="form-group"><label class="form-label">ã‹ã‹ã‚Šã¤ã‘å‹•ç‰©ç—…é™¢</label><input type="text" class="form-input" id="pet-vet" placeholder="ä¾‹ï¼šâ—‹â—‹å‹•ç‰©ç—…é™¢ï¼ˆ03-XXXX-XXXXï¼‰"></div>
      <button class="btn-primary" onclick="savePetProfile()">ğŸ’¾ ä¿å­˜ã™ã‚‹</button>
    </div>
  </div>

  <div class="page" id="page-health">
    <div class="page-title">å¥åº·è¨˜éŒ²</div>
    <div class="sub-tabs">
      <button class="sub-tab active" onclick="switchSubTab('health','record',this)">è¨˜éŒ²</button>
      <button class="sub-tab" onclick="switchSubTab('health','graph',this)">ã‚°ãƒ©ãƒ•</button>
      <button class="sub-tab" onclick="switchSubTab('health','vaccine',this)">ãƒ¯ã‚¯ãƒãƒ³</button>
    </div>
    <div class="sub-page active" id="health-sub-record">
      <button class="btn-primary" style="margin-bottom:16px" onclick="openHealthModal()">ï¼‹ ä»Šæ—¥ã®è¨˜éŒ²ã‚’ã¤ã‘ã‚‹</button>
      <div id="health-timeline"><div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></div>
    </div>
    <div class="sub-page" id="health-sub-graph">
      <div class="chart-tabs">
        <button class="chart-tab active" onclick="switchChartRange(30,this)">30æ—¥</button>
        <button class="chart-tab" onclick="switchChartRange(90,this)">90æ—¥</button>
        <button class="chart-tab" onclick="switchChartRange(365,this)">1å¹´</button>
      </div>
      <div class="card"><div class="card-title">ä½“é‡æ¨ç§»ã‚°ãƒ©ãƒ•</div><div class="chart-container"><canvas id="weightChart"></canvas></div></div>
      <div class="card">
        <div class="card-title">PDFå‡ºåŠ› <span class="plan-badge">PREMIUM</span></div>
        <p style="font-size:13px;color:var(--text-light);margin-bottom:12px">ç£åŒ»ã¸ã®è¨ºå¯Ÿæ™‚ã«ä½¿ãˆã‚‹å¥åº·è¨˜éŒ²PDFã‚’å‡ºåŠ›ã§ãã¾ã™</p>
        <button class="btn-secondary" onclick="alert('ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ï¼ˆæœˆé¡1,480å††ï¼‰ã§ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™')">ğŸ“„ PDFå‡ºåŠ›ã™ã‚‹</button>
      </div>
    </div>
    <div class="sub-page" id="health-sub-vaccine">
      <div class="section-header"><div class="card-title" style="margin:0">ãƒ¯ã‚¯ãƒãƒ³ãƒ»æ¥ç¨®è¨˜éŒ²</div><button class="add-btn" onclick="openVaccineModal()">ï¼‹ è¿½åŠ </button></div>
      <div id="vaccine-list"><div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></div>
      <div class="section-header" style="margin-top:20px"><div class="card-title" style="margin:0">æŠ•è–¬ç®¡ç†</div><button class="add-btn" onclick="openMedModal()">ï¼‹ è¿½åŠ </button></div>
      <div id="med-list"><div class="empty-state" style="padding:20px"><p>æŠ•è–¬è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p></div></div>
    </div>
  </div>

  <div class="page" id="page-note">
    <div class="page-title">ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆ</div>
    <div class="page-subtitle">ã‚‚ã—ã‚‚ã®æ™‚ã®ãŸã‚ã«ã€å¤§åˆ‡ãªæƒ³ã„ã‚’æ®‹ã™</div>
    <div class="note-section">
      <div class="note-section-title">ğŸ¾ ãƒšãƒƒãƒˆã¸ã®æƒ³ã„ãƒ»ãŠé¡˜ã„</div>
      <textarea class="form-input" id="note-message" placeholder="æ¬¡ã®é£¼ã„ä¸»ã•ã‚“ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸..." style="min-height:100px"></textarea>
    </div>
    <div class="note-section">
      <div class="note-section-title">ğŸ‘¤ æ¬¡ã®é£¼ã„ä¸»å€™è£œ</div>
      <div class="form-group"><label class="form-label">åå‰</label><input type="text" class="form-input" id="note-next-owner" placeholder="ä¾‹ï¼šç”°ä¸­ èŠ±å­"></div>
      <div class="form-group"><label class="form-label">é€£çµ¡å…ˆ</label><input type="text" class="form-input" id="note-next-contact" placeholder="ä¾‹ï¼š090-XXXX-XXXX"></div>
      <div class="form-group"><label class="form-label">ç¶šæŸ„ãƒ»é–¢ä¿‚</label><input type="text" class="form-input" id="note-next-relation" placeholder="ä¾‹ï¼šå¦¹ã€å‹äºº"></div>
    </div>
    <div class="note-section">
      <div class="note-section-title">ğŸ“‹ æ—¥å¸¸ã®ã‚±ã‚¢æƒ…å ±</div>
      <div class="form-group"><label class="form-label">é£Ÿäº‹ã®å†…å®¹ãƒ»æ™‚é–“</label><textarea class="form-input" id="note-feeding" placeholder="ä¾‹ï¼šæœ7æ™‚ãƒ»å¤œ6æ™‚ã«ã€‡ã€‡ãƒ•ãƒ¼ãƒ‰100gãšã¤"></textarea></div>
      <div class="form-group"><label class="form-label">æ•£æ­©ã®é »åº¦ãƒ»ã‚³ãƒ¼ã‚¹</label><textarea class="form-input" id="note-walk" placeholder="ä¾‹ï¼šæœæ™©30åˆ†ã€è¿‘ãã®å…¬åœ’ã¸"></textarea></div>
      <div class="form-group"><label class="form-label">æ³¨æ„äº‹é …</label><textarea class="form-input" id="note-caution" placeholder="ä¾‹ï¼šãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆNG"></textarea></div>
    </div>
    <div class="note-section">
      <div class="note-section-title">ğŸ’° æœˆã€…ã®è²»ç”¨ç›®å®‰</div>
      <div class="form-group"><label class="form-label">ãƒ•ãƒ¼ãƒ‰ä»£ï¼ˆæœˆï¼‰</label><input type="number" class="form-input" id="note-cost-food" placeholder="ä¾‹ï¼š8000"></div>
      <div class="form-group"><label class="form-label">åŒ»ç™‚è²»ï¼ˆæœˆå¹³å‡ï¼‰</label><input type="number" class="form-input" id="note-cost-medical" placeholder="ä¾‹ï¼š5000"></div>
      <div class="form-group"><label class="form-label">ãã®ä»–</label><input type="number" class="form-input" id="note-cost-other" placeholder="ä¾‹ï¼š5000"></div>
    </div>
    <button class="btn-primary" onclick="saveNote()">ğŸ’¾ ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆã‚’ä¿å­˜ã™ã‚‹</button>
    <button class="btn-secondary" onclick="shareNote()">ğŸ”— ä¿¡é ¼ã§ãã‚‹äººã«å…±æœ‰ã™ã‚‹</button>
  </div>

  <div class="page" id="page-support">
    <div class="page-title">ã‚µãƒãƒ¼ãƒˆæƒ…å ±</div>
    <div class="sub-tabs">
      <button class="sub-tab active" onclick="switchSubTab('support','info',this)">æ”¯æ´æƒ…å ±</button>
      <button class="sub-tab" onclick="switchSubTab('support','sim',this)">è²»ç”¨è©¦ç®—</button>
      <button class="sub-tab" onclick="switchSubTab('support','check',this)">æº–å‚™ç¢ºèª</button>
    </div>
    <div class="sub-page active" id="support-sub-info">
      <div class="support-category">
        <button class="cat-btn active" onclick="filterSupport('all',this)">ã™ã¹ã¦</button>
        <button class="cat-btn" onclick="filterSupport('food',this)">ğŸš ãƒ•ãƒ¼ãƒ‰ãƒãƒ³ã‚¯</button>
        <button class="cat-btn" onclick="filterSupport('foster',this)">ğŸ  ä¸€æ™‚é ã‹ã‚Š</button>
        <button class="cat-btn" onclick="filterSupport('legal',this)">âš–ï¸ æ³•å¾‹ç›¸è«‡</button>
      </div>
      <div class="support-card" data-cat="foster">
        <div class="support-name">å‹•ç‰©æ„›è­·å¸‚æ°‘å›£ä½“ JCDL</div>
        <div class="support-area">ğŸŒ å…¨å›½å¯¾å¿œãƒ»365æ—¥ãƒ»é€è¿ã‚ã‚Š</div>
        <div style="font-size:12px;color:var(--text-light);margin-bottom:8px">å¼•è¶Šã—ãƒ»å…¥é™¢ãƒ»è‚²å…ãªã©ç†ç”±ã‚’å•ã‚ãšä¸€æ™‚é ã‹ã‚Šå¯¾å¿œ</div>
        <a class="link-btn" href="https://jcdl.jp" target="_blank">ğŸŒ ã‚µã‚¤ãƒˆã‚’è¦‹ã‚‹</a>
      </div>
      <div class="support-card" data-cat="foster">
        <div class="support-name">å…¬ç›Šè²¡å›£æ³•äºº æ—¥æœ¬å‹•ç‰©æ„›è­·å”ä¼š</div>
        <div class="support-area">ğŸŒ å…¨å›½</div>
        <div style="font-size:12px;color:var(--text-light);margin-bottom:8px">ãƒšãƒƒãƒˆã«é–¢ã™ã‚‹ç›¸è«‡ãƒ»æ”¯æ´å…¨èˆ¬</div>
        <a class="link-btn" href="https://jspca.or.jp" target="_blank">ğŸŒ ã‚µã‚¤ãƒˆã‚’è¦‹ã‚‹</a>
      </div>
      <div class="support-card" data-cat="food">
        <div class="support-name">ãƒšãƒƒãƒˆã®ãƒ•ãƒ¼ãƒ‰ãƒãƒ³ã‚¯ï¼ˆåœ°åŸŸåˆ¥ï¼‰</div>
        <div class="support-area">ğŸ“ å„éƒ½é“åºœçœŒ</div>
        <div style="font-size:12px;color:var(--text-light);margin-bottom:8px">çµŒæ¸ˆçš„ã«å›°çª®ã—ãŸé£¼ã„ä¸»ã¸ã®ãƒ•ãƒ¼ãƒ‰ç„¡æ–™æä¾›</div>
        <a class="link-btn" href="https://www.google.com/search?q=ãƒšãƒƒãƒˆãƒ•ãƒ¼ãƒ‰ãƒãƒ³ã‚¯+åœ°åŸŸ" target="_blank">ğŸ” è¿‘ãã‚’æ¢ã™</a>
      </div>
      <div class="support-card" data-cat="legal">
        <div class="support-name">ãƒšãƒƒãƒˆä¿¡è¨—å¯¾å¿œ æ³•å¾‹äº‹å‹™æ‰€</div>
        <div class="support-area">ğŸŒ å…¨å›½ï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç›¸è«‡å¯ï¼‰</div>
        <div style="font-size:12px;color:var(--text-light);margin-bottom:8px">é£¼ã„ä¸»ãŒäº¡ããªã£ãŸå¾Œã®ãƒšãƒƒãƒˆã®ç”Ÿæ´»ã‚’æ³•çš„ã«ä¿è­·</div>
        <a class="link-btn" href="https://www.google.com/search?q=ãƒšãƒƒãƒˆä¿¡è¨—+æ³•å¾‹äº‹å‹™æ‰€" target="_blank">ğŸ” æ¢ã™</a>
      </div>
      <div class="support-card" data-cat="foster">
        <div class="support-name">ãƒšãƒƒãƒˆã®ãŠã†ã¡ï¼ˆé‡Œè¦ªãƒãƒƒãƒãƒ³ã‚°ï¼‰</div>
        <div class="support-area">ğŸŒ å…¨å›½</div>
        <div style="font-size:12px;color:var(--text-light);margin-bottom:8px">æ–°ã—ã„é£¼ã„ä¸»ã‚’æ¢ã™ãŸã‚ã®ãƒãƒƒãƒãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹</div>
        <a class="link-btn" href="https://www.pet-home.jp" target="_blank">ğŸŒ ã‚µã‚¤ãƒˆã‚’è¦‹ã‚‹</a>
      </div>
    </div>
    <div class="sub-page" id="support-sub-sim">
      <div class="card">
        <div class="card-title">ğŸ§® é£¼è‚²è²»ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
        <div class="form-group">
          <label class="form-label">ç¨®é¡</label>
          <select class="form-select" id="sim-species" onchange="calcSim()">
            <option value="dog-s">çŠ¬ï¼ˆå°å‹ï¼‰</option>
            <option value="dog-m">çŠ¬ï¼ˆä¸­å‹ï¼‰</option>
            <option value="dog-l">çŠ¬ï¼ˆå¤§å‹ï¼‰</option>
            <option value="cat">çŒ«</option>
          </select>
        </div>
        <div class="sim-result">
          <div class="sim-label">æœˆã€…ã®è²»ç”¨ç›®å®‰</div>
          <div class="sim-amount" id="sim-monthly">Â¥25,000</div>
          <div style="margin-top:8px;font-size:12px;opacity:0.8">å¹´é–“ <span id="sim-yearly">ç´„300,000å††</span> / 10å¹´é–“ <span id="sim-total">ç´„3,000,000å††</span></div>
        </div>
        <div class="sim-breakdown">
          <div class="sim-row"><span>ğŸš ãƒ•ãƒ¼ãƒ‰ä»£</span><span id="sim-food">æœˆ8,000å††</span></div>
          <div class="sim-row"><span>ğŸ¥ åŒ»ç™‚è²»</span><span id="sim-medical">æœˆ7,000å††</span></div>
          <div class="sim-row"><span>âœ‚ï¸ ãƒˆãƒªãƒŸãƒ³ã‚°</span><span id="sim-trim">æœˆ3,000å††</span></div>
          <div class="sim-row"><span>ğŸ›¡ï¸ ãƒšãƒƒãƒˆä¿é™º</span><span id="sim-insurance">æœˆ4,000å††</span></div>
          <div class="sim-row"><span>ğŸ›’ æ¶ˆè€—å“</span><span id="sim-supplies">æœˆ3,000å††</span></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“… ãƒ©ã‚¤ãƒ•ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
        <div class="timeline-item"><div class="timeline-date">ğŸ£ å­çŠ¬ãƒ»å­çŒ«æœŸï¼ˆ0ã€œ1æ­³ï¼‰</div><div style="font-size:13px">ãƒ¯ã‚¯ãƒãƒ³æ¥ç¨®3å›ãƒ»å»å‹¢/é¿å¦Šæ‰‹è¡“ãƒ»ãƒã‚¤ã‚¯ãƒ­ãƒãƒƒãƒ—ç™»éŒ²ãƒ»ã—ã¤ã‘æ•™å®¤</div></div>
        <div class="timeline-item"><div class="timeline-date">ğŸ• æˆçŠ¬ãƒ»æˆçŒ«æœŸï¼ˆ1ã€œ7æ­³ï¼‰</div><div style="font-size:13px">å¹´1å›ãƒ¯ã‚¯ãƒãƒ³ãƒ»ç‹‚çŠ¬ç—…äºˆé˜²æ¥ç¨®ï¼ˆçŠ¬ï¼‰ãƒ»å¹´1å›å¥åº·è¨ºæ–­ãƒ»æ­¯çŸ³é™¤å»</div></div>
        <div class="timeline-item"><div class="timeline-date">ğŸ¾ ã‚·ãƒ‹ã‚¢æœŸï¼ˆ7æ­³ã€œï¼‰</div><div style="font-size:13px">å¹´2å›å¥åº·è¨ºæ–­ãƒ»é–¢ç¯€ã‚±ã‚¢ãƒ»ã‚·ãƒ‹ã‚¢ãƒ•ãƒ¼ãƒ‰ã¸åˆ‡æ›¿ãƒ»æŠ•è–¬ç®¡ç†å¼·åŒ–</div></div>
      </div>
    </div>
    <div class="sub-page" id="support-sub-check">
      <div class="card">
        <div class="card-title">âœ… é£¼è‚²æº–å‚™ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</div>
        <div class="progress-bar"><div class="progress-fill" id="check-progress" style="width:0%"></div></div>
        <div style="text-align:right;font-size:12px;color:var(--text-light);margin-bottom:14px" id="check-count">0 / 8 å®Œäº†</div>
        <div id="checklist">
          <div class="check-item" onclick="toggleCheck(this)"><div class="check-box"></div><div><div class="check-text">ä½ç’°å¢ƒã®ç¢ºèª</div><div class="check-sub">ãƒšãƒƒãƒˆå¯ã®ä½å±…ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸ</div></div></div>
          <div class="check-item" onclick="toggleCheck(this)"><div class="check-box"></div><div><div class="check-text">å®¶æ—å…¨å“¡ã®åŒæ„</div><div class="check-sub">åŒå±…ã™ã‚‹å…¨å“¡ãŒãƒšãƒƒãƒˆã‚’è¿ãˆã‚‹ã“ã¨ã«è³›æˆã—ã¦ã„ã‚‹</div></div></div>
          <div class="check-item" onclick="toggleCheck(this)"><div class="check-box"></div><div><div class="check-text">ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã®ç¢ºèª</div><div class="check-sub">å®¶æ—å…¨å“¡ãŒã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ç¢ºèªã‚’æ¸ˆã¾ã›ãŸ</div></div></div>
          <div class="check-item" onclick="toggleCheck(this)"><div class="check-box"></div><div><div class="check-text">çµŒæ¸ˆçš„ãªä½™è£•</div><div class="check-sub">æœˆ2ã€œ5ä¸‡å††ã®é£¼è‚²è²»ã‚’10å¹´ä»¥ä¸Šè² æ‹…ã§ãã‚‹</div></div></div>
          <div class="check-item" onclick="toggleCheck(this)"><div class="check-box"></div><div><div class="check-text">æ™‚é–“çš„ãªä½™è£•</div><div class="check-sub">æ¯æ—¥ã®ãŠä¸–è©±ãƒ»æ•£æ­©ã®æ™‚é–“ãŒç¢ºä¿ã§ãã‚‹</div></div></div>
          <div class="check-item" onclick="toggleCheck(this)"><div class="check-box"></div><div><div class="check-text">ç·Šæ€¥æ™‚ã®å¯¾å¿œè€…</div><div class="check-sub">è‡ªåˆ†ãŒå…¥é™¢ã—ãŸå ´åˆã«é ã‹ã£ã¦ãã‚Œã‚‹äººãŒã„ã‚‹</div></div></div>
          <div class="check-item" onclick="toggleCheck(this)"><div class="check-box"></div><div><div class="check-text">ã‹ã‹ã‚Šã¤ã‘ç—…é™¢ã®ç¢ºèª</div><div class="check-sub">è¿‘ãã®å‹•ç‰©ç—…é™¢ã‚’èª¿ã¹ã¦é€£çµ¡å…ˆã‚’æŠŠæ¡ã—ã¦ã„ã‚‹</div></div></div>
          <div class="check-item" onclick="toggleCheck(this)"><div class="check-box"></div><div><div class="check-text">ãƒšãƒƒãƒˆä¿é™ºã®æ¤œè¨</div><div class="check-sub">åŒ»ç™‚è²»ã®å‚™ãˆã¨ã—ã¦ãƒšãƒƒãƒˆä¿é™ºã‚’æ¤œè¨ã—ãŸ</div></div></div>
        </div>
        <div id="check-result" style="display:none;margin-top:16px">
          <div style="background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white;border-radius:14px;padding:16px;text-align:center">
            <div style="font-size:24px;margin-bottom:4px">ğŸ‰</div>
            <div style="font-weight:700;font-size:16px">æº–å‚™å®Œäº†ï¼</div>
            <div style="font-size:12px;opacity:0.9;margin-top:4px">ãƒšãƒƒãƒˆã‚’è¿ãˆã‚‹æº–å‚™ãŒæ•´ã„ã¾ã—ãŸ</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Nav -->
  <nav class="bottom-nav">
    <button class="nav-item active" onclick="switchPage('home')" id="nav-home"><span class="nav-icon">ğŸ </span>ãƒ›ãƒ¼ãƒ </button>
    <button class="nav-item" onclick="switchPage('sos')" id="nav-sos"><span class="nav-icon">âš ï¸</span>SOSç›¸è«‡</button>
    <button class="nav-item" onclick="switchPage('pet')" id="nav-pet"><span class="nav-icon">ğŸ¾</span>ãƒšãƒƒãƒˆæƒ…å ±</button>
    <button class="nav-item" onclick="switchPage('health')" id="nav-health"><span class="nav-icon">â¤ï¸</span>å¥åº·è¨˜éŒ²</button>
    <button class="nav-item" onclick="switchPage('note')" id="nav-note"><span class="nav-icon">ğŸ“–</span>ãƒãƒ¼ãƒˆ</button>
    <button class="nav-item" onclick="switchPage('support')" id="nav-support"><span class="nav-icon">ğŸ”</span>ã‚µãƒãƒ¼ãƒˆ</button>
  </nav>
</div>

<!-- Health Modal -->
<div class="modal-overlay" id="health-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('health-modal')">Ã—</button>
    <div class="modal-title">ä»Šæ—¥ã®å¥åº·è¨˜éŒ²</div>
    <div class="form-group"><label class="form-label">ä½“é‡ (kg)</label><input type="number" class="form-input" id="h-weight" placeholder="ä¾‹ï¼š5.2" step="0.1"></div>
    <div class="form-group">
      <label class="form-label">é£Ÿæ¬²</label>
      <div class="icon-selector">
        <div class="icon-opt" onclick="selectOpt(this,'appetite','good')"><span class="opt-icon">ğŸ˜‹</span>è‰¯ã„</div>
        <div class="icon-opt" onclick="selectOpt(this,'appetite','normal')"><span class="opt-icon">ğŸ˜</span>æ™®é€š</div>
        <div class="icon-opt" onclick="selectOpt(this,'appetite','bad')"><span class="opt-icon">ğŸ˜</span>æ‚ªã„</div>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">é‹å‹•é‡</label>
      <div class="icon-selector">
        <div class="icon-opt" onclick="selectOpt(this,'activity','good')"><span class="opt-icon">ğŸƒ</span>æ´»ç™º</div>
        <div class="icon-opt" onclick="selectOpt(this,'activity','normal')"><span class="opt-icon">ğŸš¶</span>æ™®é€š</div>
        <div class="icon-opt" onclick="selectOpt(this,'activity','bad')"><span class="opt-icon">ğŸ˜´</span>å°‘ãªã„</div>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">ä¾¿ã®çŠ¶æ…‹</label>
      <div class="icon-selector">
        <div class="icon-opt" onclick="selectOpt(this,'stool','good')"><span class="opt-icon">âœ…</span>è‰¯å¥½</div>
        <div class="icon-opt" onclick="selectOpt(this,'stool','soft')"><span class="opt-icon">âš ï¸</span>è»Ÿä¾¿</div>
        <div class="icon-opt" onclick="selectOpt(this,'stool','bad')"><span class="opt-icon">ğŸš¨</span>ä¸‹ç—¢</div>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">å†™çœŸï¼ˆæœ€å¤§3æšï¼‰</label>
      <div class="photo-upload" onclick="document.getElementById('health-photo').click()">ğŸ“· ã‚¿ãƒƒãƒ—ã—ã¦å†™çœŸã‚’è¿½åŠ <input type="file" id="health-photo" accept="image/*" multiple style="display:none" onchange="previewHealthPhotos(event)"></div>
      <div class="photo-preview" id="health-photo-preview"></div>
    </div>
    <div class="form-group"><label class="form-label">ãƒ¡ãƒ¢</label><textarea class="form-input" id="h-memo" placeholder="æ°—ã«ãªã£ãŸã“ã¨ã‚’è¨˜éŒ²ã—ã¦ãŠãã¾ã—ã‚‡ã†"></textarea></div>
    <button class="btn-primary" onclick="saveHealthRecord()">ğŸ’¾ è¨˜éŒ²ã‚’ä¿å­˜ã™ã‚‹</button>
  </div>
</div>

<script>
// Supabase init
const SUPABASE_URL = 'https://uyqhuuicekthybrwjpvp.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5cWh1dWljZWt0aHlicndqcHZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1ODMyMjUsImV4cCI6MjA4NzE1OTIyNX0._HlmhKTBuMucnKWStKazmZjAr2lq8Zi29XyPOrclvNo';
const { createClient } = supabase;
const sb = createClient(SUPABASE_URL, SUPABASE_KEY);

let state = {
  user: null,
  petId: null,
  petProfile: null,
  healthRecords: [],
  vaccines: [],
  selectedOpts: { appetite: '', activity: '', stool: '' },
  weightChart: null,
  chartRange: 30
};

// Solutions
const solutions = {
  moving: { title: 'å¼•è¶Šã—å…ˆãŒãƒšãƒƒãƒˆä¸å¯', items: ['ãƒšãƒƒãƒˆå¯ç‰©ä»¶ã¸ã®å¼•è¶Šã—ã‚’æ¤œè¨ã™ã‚‹','å¤§å®¶ã•ã‚“ã¸äº¤æ¸‰ã™ã‚‹ï¼ˆæ•·é‡‘å¢—é¡ã‚’ææ¡ˆï¼‰','ä¸€æ™‚çš„ã«ä¿¡é ¼ã§ãã‚‹äººã«é ã‘ã‚‹','ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆã«å¼•ãç¶™ãæƒ…å ±ã‚’æ®‹ã—ã¦ãŠã'], orgs: [{ name: 'ãƒšãƒƒãƒˆå¯ç‰©ä»¶æ¤œç´¢ï¼ˆSUUMOï¼‰', url: 'https://suumo.jp' }, { name: 'å‹•ç‰©æ„›è­·å¸‚æ°‘å›£ä½“JCDLï¼ˆä¸€æ™‚é ã‹ã‚Šï¼‰', url: 'https://jcdl.jp' }] },
  money: { title: 'çµŒæ¸ˆçš„ã«è‹¦ã—ããªã£ãŸ', items: ['ãƒšãƒƒãƒˆãƒ•ãƒ¼ãƒ‰ãƒãƒ³ã‚¯ã‚’åˆ©ç”¨ã™ã‚‹ï¼ˆç„¡æ–™ï¼‰','ä½ä¾¡æ ¼å‹•ç‰©ç—…é™¢ã‚’åˆ©ç”¨ã™ã‚‹','ãƒšãƒƒãƒˆä¿é™ºã®è¦‹ç›´ã—ã‚’ã™ã‚‹','è‡ªæ²»ä½“ã®ç”Ÿæ´»æ”¯æ´ç›¸è«‡çª“å£ã¸ç›¸è«‡ã™ã‚‹'], orgs: [{ name: 'ãƒšãƒƒãƒˆãƒ•ãƒ¼ãƒ‰ãƒãƒ³ã‚¯ï¼ˆåœ°åŸŸåˆ¥ï¼‰', url: 'https://www.google.com/search?q=ãƒšãƒƒãƒˆãƒ•ãƒ¼ãƒ‰ãƒãƒ³ã‚¯+è¿‘ã' }, { name: 'ç¤¾ä¼šç¦ç¥‰å”è­°ä¼š', url: 'https://www.google.com/search?q=ç¤¾ä¼šç¦ç¥‰å”è­°ä¼š+è¿‘ã' }] },
  allergy: { title: 'å®¶æ—ãŒã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã«ãªã£ãŸ', items: ['ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å°‚é–€åŒ»ã«ç›¸è«‡ã™ã‚‹','ç©ºæ°—æ¸…æµ„æ©Ÿã®è¨­ç½®ãƒ»ã“ã¾ã‚ãªæƒé™¤','ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³å…ç–«ç™‚æ³•ã‚’æ¤œè¨ã™ã‚‹','ã©ã†ã—ã¦ã‚‚ç„¡ç†ãªå ´åˆã¯è²¬ä»»ã‚ã‚‹è­²æ¸¡å…ˆã‚’æ¢ã™'], orgs: [{ name: 'ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å°‚é–€å¤–æ¥', url: 'https://www.google.com/search?q=ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å°‚é–€å¤–æ¥+è¿‘ã' }, { name: 'ãƒšãƒƒãƒˆã®ãŠã†ã¡ï¼ˆé‡Œè¦ªï¼‰', url: 'https://www.pet-home.jp' }] },
  hospital: { title: 'å…¥é™¢ãƒ»ä»‹è­·ãŒå¿…è¦ã«ãªã£ãŸ', items: ['ãƒšãƒƒãƒˆä¿¡è¨—ã‚’æ´»ç”¨ã™ã‚‹ï¼ˆæ³•çš„ã«å®‰å¿ƒï¼‰','ä¸€æ™‚é ã‹ã‚Šã‚µãƒ¼ãƒ“ã‚¹ã‚’æ‰‹é…ã™ã‚‹','ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆã«ã‚±ã‚¢æƒ…å ±ã‚’è¨˜éŒ²ã—ã¦ãŠã','äº‹å‰ã«æ¬¡ã®é£¼ã„ä¸»å€™è£œã‚’ç™»éŒ²ã—ã¦ãŠã'], orgs: [{ name: 'å‹•ç‰©æ„›è­·å¸‚æ°‘å›£ä½“JCDL', url: 'https://jcdl.jp' }, { name: 'ãƒšãƒƒãƒˆä¿¡è¨—å¯¾å¿œ æ³•å¾‹äº‹å‹™æ‰€', url: 'https://www.google.com/search?q=ãƒšãƒƒãƒˆä¿¡è¨—+æ³•å¾‹äº‹å‹™æ‰€' }] },
  baby: { title: 'å‡ºç”£ãƒ»è‚²å…ã§æ‰‹ãŒå›ã‚‰ãªã„', items: ['ãƒšãƒƒãƒˆã‚·ãƒƒã‚¿ãƒ¼ã‚’åˆ©ç”¨ã™ã‚‹','å®¶æ—ã‚„å‹äººã«ä¸€æ™‚çš„ã«æ‰‹ä¼ã£ã¦ã‚‚ã‚‰ã†','è‚²å…ãŒè½ã¡ç€ãã¾ã§ä¸€æ™‚é ã‹ã‚Šã‚’åˆ©ç”¨ã™ã‚‹','ç”Ÿæ´»ãƒªã‚ºãƒ ã‚’è¦‹ç›´ã—ã¦ãƒšãƒƒãƒˆã®æ™‚é–“ã‚’ç¢ºä¿ã™ã‚‹'], orgs: [{ name: 'ãƒšãƒƒãƒˆã‚·ãƒƒã‚¿ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹', url: 'https://www.google.com/search?q=ãƒšãƒƒãƒˆã‚·ãƒƒã‚¿ãƒ¼+è¿‘ã' }, { name: 'å‹•ç‰©æ„›è­·å¸‚æ°‘å›£ä½“JCDL', url: 'https://jcdl.jp' }] },
  different: { title: 'æ€ã£ã¦ã„ãŸé£¼è‚²ã¨é•ã£ãŸ', items: ['ãƒ‰ãƒƒã‚°ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã‚„å°‚é–€å®¶ã«ç›¸è«‡ã™ã‚‹','ã—ã¤ã‘æ•™å®¤ã«é€šã†','å•é¡Œè¡Œå‹•ã®åŸå› ã‚’ç†è§£ã—ã¦å¯¾å‡¦æ³•ã‚’å­¦ã¶','ã©ã†ã—ã¦ã‚‚ç„¡ç†ãªå ´åˆã¯è²¬ä»»ã‚ã‚‹è­²æ¸¡å…ˆã‚’æ¢ã™'], orgs: [{ name: 'ãƒ‰ãƒƒã‚°ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼', url: 'https://www.google.com/search?q=ãƒ‰ãƒƒã‚°ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼+è¿‘ã' }, { name: 'ãƒšãƒƒãƒˆã®ãŠã†ã¡ï¼ˆé‡Œè¦ªï¼‰', url: 'https://www.pet-home.jp' }] },
  other: { title: 'ãã®ä»–ã®ã”ç›¸è«‡', items: ['å‹•ç‰©æ„›è­·å›£ä½“ã¸ç›¸è«‡ã™ã‚‹','ç£åŒ»å¸«ã‚„å°‚é–€å®¶ã¸ç›¸è«‡ã™ã‚‹','åœ°åŸŸã®å‹•ç‰©æ„›è­·ã‚»ãƒ³ã‚¿ãƒ¼ã¸å•ã„åˆã‚ã›ã‚‹'], orgs: [{ name: 'æ—¥æœ¬å‹•ç‰©æ„›è­·å”ä¼š', url: 'https://jspca.or.jp' }, { name: 'å‹•ç‰©æ„›è­·å¸‚æ°‘å›£ä½“JCDL', url: 'https://jcdl.jp' }] }
};

// Auth
function switchAuthTab(tab) {
  document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('login-form').style.display = tab === 'login' ? 'block' : 'none';
  document.getElementById('signup-form').style.display = tab === 'signup' ? 'block' : 'none';
  document.getElementById('auth-message').innerHTML = '';
}

function showAuthMsg(msg, type) {
  document.getElementById('auth-message').innerHTML = `<div class="auth-msg ${type}">${msg}</div>`;
}

async function handleLogin() {
  const email = document.getElementById('login-email').value;
  const password = document.getElementById('login-password').value;
  if (!email || !password) { showAuthMsg('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error'); return; }
  const btn = document.getElementById('login-btn');
  btn.disabled = true; btn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...';
  const { data, error } = await sb.auth.signInWithPassword({ email, password });
  btn.disabled = false; btn.textContent = 'ğŸ¾ ãƒ­ã‚°ã‚¤ãƒ³';
  if (error) { showAuthMsg('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚', 'error'); return; }
  onLogin(data.user);
}

async function handleSignup() {
  const email = document.getElementById('signup-email').value;
  const password = document.getElementById('signup-password').value;
  if (!email || !password) { showAuthMsg('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error'); return; }
  if (password.length < 6) { showAuthMsg('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„', 'error'); return; }
  const btn = document.getElementById('signup-btn');
  btn.disabled = true; btn.textContent = 'ç™»éŒ²ä¸­...';
  const { data, error } = await sb.auth.signUp({ email, password });
  btn.disabled = false; btn.textContent = 'ğŸ¾ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹';
  if (error) { showAuthMsg('ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error'); return; }
  showAuthMsg('âœ… ç™»éŒ²å®Œäº†ï¼ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚', 'success');
}

async function handleLogout() {
  await sb.auth.signOut();
  state.user = null;
  document.getElementById('auth-screen').style.display = 'flex';
  document.getElementById('app-screen').classList.remove('active');
}

async function onLogin(user) {
  state.user = user;
  document.getElementById('auth-screen').style.display = 'none';
  document.getElementById('app-screen').classList.add('active');
  await ensureProfile();
  await loadPetProfile();
  await loadHealthRecords();
  updateHome();
  calcSim();
}

async function ensureProfile() {
  const { data } = await sb.from('profiles').select('*').eq('id', state.user.id).single();
  if (!data) {
    await sb.from('profiles').insert({ id: state.user.id, email: state.user.email });
  }
}

// Pet Profile
async function loadPetProfile() {
  const { data } = await sb.from('pets').select('*').eq('user_id', state.user.id).single();
  if (data) {
    state.petProfile = data;
    state.petId = data.id;
    fillPetForm(data);
  }
}

function fillPetForm(p) {
  if (p.name) document.getElementById('pet-name').value = p.name;
  if (p.species) document.getElementById('pet-species').value = p.species;
  if (p.breed) document.getElementById('pet-breed').value = p.breed;
  if (p.age) document.getElementById('pet-age').value = p.age;
  if (p.gender) document.getElementById('pet-gender').value = p.gender;
  if (p.personality) document.getElementById('pet-personality').value = p.personality;
  if (p.food) document.getElementById('pet-food').value = p.food;
  if (p.fears) document.getElementById('pet-fears').value = p.fears;
  if (p.medical) document.getElementById('pet-medical').value = p.medical;
  if (p.meds) document.getElementById('pet-meds').value = p.meds;
  if (p.chip) document.getElementById('pet-chip').value = p.chip;
  if (p.vet) document.getElementById('pet-vet').value = p.vet;
  if (p.photo) document.getElementById('pet-avatar-display').innerHTML = `<img src="${p.photo}" style="width:80px;height:80px;object-fit:cover;border-radius:50%">`;
}

async function savePetProfile() {
  const profile = {
    user_id: state.user.id,
    name: document.getElementById('pet-name').value,
    species: document.getElementById('pet-species').value,
    breed: document.getElementById('pet-breed').value,
    age: parseInt(document.getElementById('pet-age').value) || null,
    gender: document.getElementById('pet-gender').value,
    personality: document.getElementById('pet-personality').value,
    food: document.getElementById('pet-food').value,
    fears: document.getElementById('pet-fears').value,
    medical: document.getElementById('pet-medical').value,
    meds: document.getElementById('pet-meds').value,
    chip: document.getElementById('pet-chip').value,
    vet: document.getElementById('pet-vet').value,
    photo: state.petProfile?.photo || null
  };

  if (state.petId) {
    await sb.from('pets').update(profile).eq('id', state.petId);
  } else {
    const { data } = await sb.from('pets').insert(profile).select().single();
    if (data) { state.petId = data.id; }
  }
  state.petProfile = profile;
  alert('âœ… ãƒšãƒƒãƒˆæƒ…å ±ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
  updateHome();
}

function setPetPhoto(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    document.getElementById('pet-avatar-display').innerHTML = `<img src="${ev.target.result}" style="width:80px;height:80px;object-fit:cover;border-radius:50%">`;
    if (!state.petProfile) state.petProfile = {};
    state.petProfile.photo = ev.target.result;
  };
  reader.readAsDataURL(file);
}

function updateHome() {
  const p = state.petProfile;
  const el = document.getElementById('pet-summary-content');
  if (p && p.name) {
    el.innerHTML = `<div style="display:flex;align-items:center;gap:12px"><div style="width:50px;height:50px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;font-size:24px;border:2px solid var(--primary);overflow:hidden;flex-shrink:0">${p.photo ? `<img src="${p.photo}" style="width:100%;height:100%;object-fit:cover">` : 'ğŸ¶'}</div><div><div style="font-weight:700;font-size:16px">${p.name}</div><div style="font-size:12px;color:var(--text-light)">${p.breed || ''} ${p.age ? p.age + 'æ­³' : ''}</div></div></div>`;
  }
}

// Health Records
async function loadHealthRecords() {
  if (!state.user) return;
  const { data } = await sb.from('health_records').select('*').eq('user_id', state.user.id).order('recorded_at', { ascending: false }).limit(30);
  if (data) { state.healthRecords = data; updateHealthTimeline(); }
}

function openHealthModal() {
  state.selectedOpts = { appetite: '', activity: '', stool: '' };
  document.getElementById('h-weight').value = '';
  document.getElementById('h-memo').value = '';
  document.getElementById('health-photo-preview').innerHTML = '';
  document.querySelectorAll('.icon-opt').forEach(o => o.classList.remove('selected'));
  document.getElementById('health-modal').classList.add('active');
}

function closeModal(id) { document.getElementById(id).classList.remove('active'); }

function selectOpt(el, type, val) {
  el.closest('.icon-selector').querySelectorAll('.icon-opt').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
  state.selectedOpts[type] = val;
}

function previewHealthPhotos(e) {
  const preview = document.getElementById('health-photo-preview');
  preview.innerHTML = '';
  Array.from(e.target.files).slice(0, 3).forEach(file => {
    const reader = new FileReader();
    reader.onload = (ev) => { const img = document.createElement('img'); img.src = ev.target.result; img.className = 'photo-thumb'; preview.appendChild(img); };
    reader.readAsDataURL(file);
  });
}

async function saveHealthRecord() {
  const weight = parseFloat(document.getElementById('h-weight').value);
  const memo = document.getElementById('h-memo').value;
  const photos = Array.from(document.getElementById('health-photo-preview').querySelectorAll('img')).map(i => i.src);

  const record = {
    user_id: state.user.id,
    pet_id: state.petId,
    weight: weight || null,
    appetite: state.selectedOpts.appetite,
    activity: state.selectedOpts.activity,
    stool: state.selectedOpts.stool,
    memo,
    photos
  };

  const { data } = await sb.from('health_records').insert(record).select().single();
  if (data) { state.healthRecords.unshift(data); }

  if (state.healthRecords.length >= 2 && weight) {
    const prev = state.healthRecords[1].weight;
    if (prev) {
      const change = Math.abs((weight - prev) / prev * 100);
      if (change >= 3) setTimeout(() => alert('âš ï¸ ä½“é‡ãŒå‰å›æ¯”' + change.toFixed(1) + '%å¤‰åŒ–ã—ã¦ã„ã¾ã™ã€‚ç£åŒ»ã¸ã®ç›¸è«‡ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚'), 300);
    }
  }

  closeModal('health-modal');
  updateHealthTimeline();
}

function updateHealthTimeline() {
  const container = document.getElementById('health-timeline');
  if (!state.healthRecords || state.healthRecords.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“‹</div><p>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“<br>ä»Šæ—¥ã®è¨˜éŒ²ã‚’ã¤ã‘ã¾ã—ã‚‡ã†</p></div>`;
    return;
  }
  const appetiteLabel = { good: 'ğŸ˜‹ é£Ÿæ¬²è‰¯å¥½', normal: 'ğŸ˜ é£Ÿæ¬²æ™®é€š', bad: 'ğŸ˜ é£Ÿæ¬²ä¸æŒ¯' };
  const activityLabel = { good: 'ğŸƒ æ´»ç™º', normal: 'ğŸš¶ æ™®é€š', bad: 'ğŸ˜´ æ´»å‹•å°‘' };
  const stoolLabel = { good: 'âœ… ä¾¿è‰¯å¥½', soft: 'âš ï¸ è»Ÿä¾¿', bad: 'ğŸš¨ ä¸‹ç—¢' };

  container.innerHTML = state.healthRecords.slice(0, 10).map((r, i) => {
    const prev = state.healthRecords[i + 1];
    let weightChange = '';
    if (r.weight && prev && prev.weight) {
      const diff = r.weight - prev.weight;
      if (diff > 0) weightChange = `<span class="weight-change up">â–²${diff.toFixed(1)}kg</span>`;
      else if (diff < 0) weightChange = `<span class="weight-change down">â–¼${Math.abs(diff).toFixed(1)}kg</span>`;
    }
    return `<div class="timeline-item"><div class="timeline-date">${new Date(r.recorded_at).toLocaleDateString('ja-JP')}</div>${r.weight ? `<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><span class="weight-display">${r.weight}kg</span>${weightChange}</div>` : ''}<div class="health-icons">${r.appetite ? `<span class="health-badge">${appetiteLabel[r.appetite]}</span>` : ''}${r.activity ? `<span class="health-badge">${activityLabel[r.activity]}</span>` : ''}${r.stool ? `<span class="health-badge">${stoolLabel[r.stool]}</span>` : ''}</div>${r.photos && r.photos.length > 0 ? `<div class="photo-preview">${r.photos.map(p => `<img src="${p}" class="photo-thumb">`).join('')}</div>` : ''}${r.memo ? `<div style="font-size:12px;color:var(--text-light);margin-top:6px">ğŸ“ ${r.memo}</div>` : ''}</div>`;
  }).join('');
}

// Chart
function initChart() {
  const records = state.healthRecords.filter(r => r.weight).slice(0, state.chartRange).reverse();
  const labels = records.map(r => new Date(r.recorded_at).toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' }));
  const data = records.map(r => r.weight);
  const ctx = document.getElementById('weightChart');
  if (!ctx) return;
  if (state.weightChart) state.weightChart.destroy();
  const avg = data.length > 0 ? data.reduce((a, b) => a + b, 0) / data.length : 5;
  state.weightChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels.length > 0 ? labels : ['è¨˜éŒ²ãªã—'],
      datasets: [
        { label: 'ä½“é‡(kg)', data: data.length > 0 ? data : [0], borderColor: '#E8845A', backgroundColor: 'rgba(232,132,90,0.1)', borderWidth: 2, pointBackgroundColor: '#E8845A', tension: 0.3, fill: true },
        { label: 'ç†æƒ³ä½“é‡', data: labels.map(() => avg), borderColor: '#8B6F5E', borderWidth: 1, borderDash: [5, 5], pointRadius: 0 }
      ]
    },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: false, grid: { color: '#EDD9C8' } }, x: { grid: { display: false } } } }
  });
}

function switchChartRange(range, el) {
  state.chartRange = range;
  document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  initChart();
}

// Vaccines
async function loadVaccines() {
  if (!state.user) return;
  const { data } = await sb.from('vaccines').select('*').eq('user_id', state.user.id);
  if (data) { state.vaccines = data; renderVaccines(); }
}

function renderVaccines() {
  const container = document.getElementById('vaccine-list');
  if (!state.vaccines || state.vaccines.length === 0) {
    container.innerHTML = `<div class="empty-state" style="padding:20px"><p>ãƒ¯ã‚¯ãƒãƒ³è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p></div>`;
    return;
  }
  const today = new Date();
  container.innerHTML = state.vaccines.map(v => {
    const next = v.next_date ? new Date(v.next_date) : null;
    const diff = next ? Math.ceil((next - today) / (1000 * 60 * 60 * 24)) : null;
    const badge = diff !== null ? (diff <= 7 ? `<span class="vaccine-alert">âš ï¸ ${diff === 0 ? 'ä»Šæ—¥' : diff + 'æ—¥å¾Œ'}</span>` : `<span class="vaccine-ok">âœ“ ä½™è£•ã‚ã‚Š</span>`) : '';
    return `<div class="vaccine-item"><div><div class="vaccine-name">${v.name}</div>${v.next_date ? `<div class="vaccine-date">æ¬¡å›ï¼š${new Date(v.next_date).toLocaleDateString('ja-JP')}</div>` : ''}</div>${badge}</div>`;
  }).join('');
}

async function openVaccineModal() {
  const name = prompt('ãƒ¯ã‚¯ãƒãƒ³åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šæ··åˆãƒ¯ã‚¯ãƒãƒ³5ç¨®ï¼‰');
  if (!name) return;
  const nextDate = prompt('æ¬¡å›æ¥ç¨®äºˆå®šæ—¥ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼š2026-06-01ï¼‰');
  const { data } = await sb.from('vaccines').insert({ user_id: state.user.id, pet_id: state.petId, name, next_date: nextDate || null }).select().single();
  if (data) { state.vaccines.push(data); renderVaccines(); }
}

async function openMedModal() {
  const name = prompt('è–¬ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
  if (!name) return;
  const dosage = prompt('ç”¨é‡ãƒ»æœç”¨æ–¹æ³•ï¼ˆä¾‹ï¼š1æ—¥1å›1éŒ ï¼‰');
  const medList = document.getElementById('med-list');
  const existing = medList.querySelectorAll('.vaccine-item').length;
  if (existing === 0) medList.innerHTML = '';
  medList.innerHTML += `<div class="vaccine-item"><div><div class="vaccine-name">${name}</div><div class="vaccine-date">${dosage}</div></div><span class="vaccine-ok">æœç”¨ä¸­</span></div>`;
}

// Note
async function loadNote() {
  if (!state.petId) return;
  const { data } = await sb.from('tasuki_notes').select('*').eq('user_id', state.user.id).single();
  if (data) {
    if (data.message) document.getElementById('note-message').value = data.message;
    if (data.next_owner) document.getElementById('note-next-owner').value = data.next_owner;
    if (data.next_contact) document.getElementById('note-next-contact').value = data.next_contact;
    if (data.next_relation) document.getElementById('note-next-relation').value = data.next_relation;
    if (data.feeding) document.getElementById('note-feeding').value = data.feeding;
    if (data.walk) document.getElementById('note-walk').value = data.walk;
    if (data.caution) document.getElementById('note-caution').value = data.caution;
    if (data.cost_food) document.getElementById('note-cost-food').value = data.cost_food;
    if (data.cost_medical) document.getElementById('note-cost-medical').value = data.cost_medical;
    if (data.cost_other) document.getElementById('note-cost-other').value = data.cost_other;
  }
}

async function saveNote() {
  const note = {
    user_id: state.user.id,
    pet_id: state.petId,
    message: document.getElementById('note-message').value,
    next_owner: document.getElementById('note-next-owner').value,
    next_contact: document.getElementById('note-next-contact').value,
    next_relation: document.getElementById('note-next-relation').value,
    feeding: document.getElementById('note-feeding').value,
    walk: document.getElementById('note-walk').value,
    caution: document.getElementById('note-caution').value,
    cost_food: parseInt(document.getElementById('note-cost-food').value) || null,
    cost_medical: parseInt(document.getElementById('note-cost-medical').value) || null,
    cost_other: parseInt(document.getElementById('note-cost-other').value) || null
  };
  const { data: existing } = await sb.from('tasuki_notes').select('id').eq('user_id', state.user.id).single();
  if (existing) { await sb.from('tasuki_notes').update(note).eq('id', existing.id); }
  else { await sb.from('tasuki_notes').insert(note); }
  alert('âœ… ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ');
}

function shareNote() {
  if (navigator.share) { navigator.share({ title: 'Tasuki ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆ', text: 'ã‚‚ã—ã‚‚ã®æ™‚ã®ãŸã‚ã®ãƒšãƒƒãƒˆã‚±ã‚¢æƒ…å ±ã§ã™', url: window.location.href }); }
  else { navigator.clipboard.writeText(window.location.href).then(() => alert('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')); }
}

// SOS
function showSolution(key) {
  const sol = solutions[key];
  document.getElementById('solution-area').innerHTML = `<div style="background:var(--white);border:1px solid var(--border);border-radius:16px;padding:16px;margin-top:12px"><div style="font-size:16px;font-weight:700;margin-bottom:12px">ğŸ“‹ ${sol.title}</div><div style="font-size:13px;font-weight:700;margin-bottom:8px">å…·ä½“çš„ãªè§£æ±ºç­–</div>${sol.items.map((item, i) => `<div class="solution-item"><div class="solution-num">${i+1}</div><div>${item}</div></div>`).join('')}<div style="margin-top:12px"><div style="font-size:13px;font-weight:700;margin-bottom:8px">ç›¸è«‡å…ˆãƒ»æ”¯æ´å›£ä½“</div>${sol.orgs.map(org => `<div class="org-item"><div class="org-name">${org.name}</div><a class="org-link" href="${org.url}" target="_blank">ğŸŒ è©³ã—ãè¦‹ã‚‹ â†’</a></div>`).join('')}</div><div class="action-btns"><button class="action-btn" onclick="switchPage('note')">ğŸ“– ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆã‚’æ›¸ã</button><button class="action-btn" onclick="switchPage('support')">ğŸ” æ”¯æ´ã‚’æ¢ã™</button></div></div>`;
  document.getElementById('solution-area').scrollIntoView({ behavior: 'smooth' });
}

// Navigation
function switchPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.getElementById('nav-' + page).classList.add('active');
  if (page === 'health') { updateHealthTimeline(); setTimeout(initChart, 100); loadVaccines(); }
  if (page === 'note') loadNote();
}

function switchSubTab(page, tab, el) {
  const prefix = page + '-sub-';
  document.querySelectorAll(`[id^="${prefix}"]`).forEach(p => p.classList.remove('active'));
  document.getElementById(prefix + tab).classList.add('active');
  document.querySelectorAll(`#page-${page} .sub-tab`).forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  if (tab === 'graph') setTimeout(initChart, 100);
}

function filterSupport(cat, el) {
  document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  document.querySelectorAll('.support-card').forEach(card => { card.style.display = (cat === 'all' || card.dataset.cat === cat) ? 'block' : 'none'; });
}

function calcSim() {
  const species = document.getElementById('sim-species')?.value || 'dog-s';
  const costs = { 'dog-s': { food: 6000, medical: 6000, trim: 4000, insurance: 3000, supplies: 2000 }, 'dog-m': { food: 9000, medical: 8000, trim: 5000, insurance: 4000, supplies: 3000 }, 'dog-l': { food: 15000, medical: 10000, trim: 6000, insurance: 5000, supplies: 4000 }, 'cat': { food: 5000, medical: 5000, trim: 1000, insurance: 2500, supplies: 2000 } };
  const c = costs[species];
  const monthly = Object.values(c).reduce((a, b) => a + b, 0);
  document.getElementById('sim-monthly').textContent = 'Â¥' + monthly.toLocaleString();
  document.getElementById('sim-yearly').textContent = 'ç´„' + (monthly * 12).toLocaleString() + 'å††';
  document.getElementById('sim-total').textContent = 'ç´„' + (monthly * 120).toLocaleString() + 'å††';
  document.getElementById('sim-food').textContent = 'æœˆ' + c.food.toLocaleString() + 'å††';
  document.getElementById('sim-medical').textContent = 'æœˆ' + c.medical.toLocaleString() + 'å††';
  document.getElementById('sim-trim').textContent = 'æœˆ' + c.trim.toLocaleString() + 'å††';
  document.getElementById('sim-insurance').textContent = 'æœˆ' + c.insurance.toLocaleString() + 'å††';
  document.getElementById('sim-supplies').textContent = 'æœˆ' + c.supplies.toLocaleString() + 'å††';
}

function toggleCheck(el) {
  const box = el.querySelector('.check-box');
  box.classList.toggle('checked');
  box.textContent = box.classList.contains('checked') ? 'âœ“' : '';
  const total = document.querySelectorAll('.check-item').length;
  const done = document.querySelectorAll('.check-box.checked').length;
  document.getElementById('check-progress').style.width = (done / total * 100) + '%';
  document.getElementById('check-count').textContent = done + ' / ' + total + ' å®Œäº†';
  document.getElementById('check-result').style.display = done === total ? 'block' : 'none';
}

// Auth state check
sb.auth.onAuthStateChange((event, session) => {
  if (session?.user) { onLogin(session.user); }
});
</script>
</body>
</html>
