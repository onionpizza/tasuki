<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#E8845A">
  <meta name="description" content="å¤§åˆ‡ãªå‘½ã‚’ã€æ¬¡ã¸ã¤ãªãã€‚ãƒšãƒƒãƒˆã®ã‚‚ã—ã‚‚ã«å‚™ãˆã‚‹ã‚¢ãƒ—ãƒª">
  <title>Tasuki ã‚¿ã‚¹ã‚­ - å¤§åˆ‡ãªå‘½ã‚’ã€æ¬¡ã¸ã¤ãªãã€‚</title>
  <link rel="manifest" href="manifest.json">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #E8845A;
      --primary-light: #F5A07A;
      --primary-dark: #C86A40;
      --accent: #F5E6D3;
      --text: #3D2B1F;
      --text-light: #8B6F5E;
      --white: #FFFFFF;
      --bg: #FDF8F4;
      --card: #FFFFFF;
      --border: #EDD9C8;
      --danger: #E53E3E;
      --success: #38A169;
      --warning: #D69E2E;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: var(--bg);
      color: var(--text);
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      padding-bottom: 80px;
    }

    /* Header */
    .header {
      background: var(--white);
      padding: 16px 20px;
      text-align: center;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .logo-icon { font-size: 28px; }

    .logo-text {
      font-family: 'Poppins', sans-serif;
      font-size: 22px;
      font-weight: 700;
      color: var(--primary);
    }

    .logo-text span {
      font-family: 'Noto Sans JP', sans-serif;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-light);
      margin-left: 4px;
    }

    .tagline {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 2px;
    }

    /* Bottom Nav */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 480px;
      background: var(--white);
      border-top: 1px solid var(--border);
      display: flex;
      z-index: 100;
    }

    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px 4px;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      background: none;
      color: var(--text-light);
      font-size: 10px;
      font-family: 'Noto Sans JP', sans-serif;
    }

    .nav-item.active { color: var(--primary); }
    .nav-item .nav-icon { font-size: 20px; margin-bottom: 2px; }

    /* Pages */
    .page { display: none; padding: 16px; }
    .page.active { display: block; }

    /* Cards */
    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid var(--border);
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }

    .card-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 12px;
    }

    /* SOS Button */
    .sos-btn {
      background: linear-gradient(135deg, #E53E3E, #C53030);
      color: white;
      border: none;
      border-radius: 16px;
      padding: 18px;
      width: 100%;
      font-size: 18px;
      font-weight: 700;
      font-family: 'Noto Sans JP', sans-serif;
      cursor: pointer;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 16px rgba(229,62,62,0.3);
      transition: transform 0.1s;
    }

    .sos-btn:active { transform: scale(0.98); }

    /* Alert Banner */
    .alert-banner {
      background: #FFF5F5;
      border: 1px solid #FED7D7;
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--danger);
    }

    /* Quick Menu Grid */
    .quick-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 12px;
    }

    .quick-item {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quick-item:active { transform: scale(0.97); background: var(--accent); }
    .quick-item .icon { font-size: 24px; margin-bottom: 6px; }
    .quick-item .label { font-size: 12px; font-weight: 700; color: var(--text); }
    .quick-item .sub { font-size: 10px; color: var(--text-light); margin-top: 2px; }

    /* SOS Situations */
    .situation-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.2s;
    }

    .situation-card:active { background: var(--accent); }
    .situation-card .sit-icon { font-size: 28px; }
    .situation-card .sit-text { font-size: 15px; font-weight: 500; }

    /* Solution Panel */
    .solution-panel {
      display: none;
      background: var(--accent);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .solution-panel.active { display: block; }

    .solution-title {
      font-size: 15px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 12px;
    }

    .solution-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 10px;
      font-size: 13px;
    }

    .solution-num {
      background: var(--primary);
      color: white;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
      flex-shrink: 0;
    }

    .org-list { margin-top: 12px; }
    .org-title { font-size: 13px; font-weight: 700; margin-bottom: 8px; }

    .org-item {
      background: var(--white);
      border-radius: 10px;
      padding: 10px 12px;
      margin-bottom: 6px;
      font-size: 12px;
    }

    .org-name { font-weight: 700; color: var(--text); }
    .org-link { color: var(--primary); text-decoration: none; font-size: 11px; }

    .action-btns {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 12px;
    }

    .action-btn {
      background: var(--white);
      border: 1px solid var(--primary);
      color: var(--primary);
      border-radius: 10px;
      padding: 10px;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      font-family: 'Noto Sans JP', sans-serif;
      text-align: center;
    }

    /* Forms */
    .form-group { margin-bottom: 14px; }

    .form-label {
      font-size: 13px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 6px;
      display: block;
    }

    .form-input {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 14px;
      font-family: 'Noto Sans JP', sans-serif;
      background: var(--white);
      color: var(--text);
      outline: none;
      transition: border-color 0.2s;
    }

    .form-input:focus { border-color: var(--primary); }

    .form-select {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 14px;
      font-family: 'Noto Sans JP', sans-serif;
      background: var(--white);
      color: var(--text);
      outline: none;
    }

    /* Icon Selector */
    .icon-selector {
      display: flex;
      gap: 8px;
    }

    .icon-opt {
      flex: 1;
      padding: 10px 6px;
      border: 2px solid var(--border);
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
    }

    .icon-opt .opt-icon { font-size: 20px; display: block; margin-bottom: 2px; }
    .icon-opt.selected { border-color: var(--primary); background: var(--accent); }

    /* Primary Button */
    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 14px;
      width: 100%;
      font-size: 15px;
      font-weight: 700;
      font-family: 'Noto Sans JP', sans-serif;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 8px;
    }

    .btn-primary:active { transform: scale(0.98); }

    .btn-secondary {
      background: var(--white);
      color: var(--primary);
      border: 2px solid var(--primary);
      border-radius: 12px;
      padding: 12px;
      width: 100%;
      font-size: 14px;
      font-weight: 700;
      font-family: 'Noto Sans JP', sans-serif;
      cursor: pointer;
      margin-top: 8px;
    }

    /* Health Timeline */
    .timeline-item {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      margin-bottom: 10px;
    }

    .timeline-date { font-size: 12px; color: var(--text-light); margin-bottom: 6px; }

    .health-icons { display: flex; gap: 8px; margin-bottom: 6px; }

    .health-badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 20px;
      background: var(--accent);
      color: var(--text);
    }

    .weight-display {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary);
    }

    .weight-change {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 20px;
    }

    .weight-change.up { background: #FFF5F5; color: var(--danger); }
    .weight-change.down { background: #F0FFF4; color: var(--success); }
    .weight-change.same { background: var(--accent); color: var(--text-light); }

    /* Chart */
    .chart-container {
      position: relative;
      height: 200px;
      margin: 12px 0;
    }

    .chart-tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 12px;
    }

    .chart-tab {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 12px;
      border: 1px solid var(--border);
      cursor: pointer;
      background: var(--white);
      font-family: 'Noto Sans JP', sans-serif;
    }

    .chart-tab.active { background: var(--primary); color: white; border-color: var(--primary); }

    /* Vaccine List */
    .vaccine-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: var(--accent);
      border-radius: 10px;
      margin-bottom: 8px;
    }

    .vaccine-name { font-size: 13px; font-weight: 700; }
    .vaccine-date { font-size: 11px; color: var(--text-light); }

    .vaccine-alert {
      background: #FFF5F5;
      border: 1px solid #FED7D7;
      border-radius: 20px;
      padding: 3px 10px;
      font-size: 11px;
      color: var(--danger);
      font-weight: 700;
    }

    .vaccine-ok {
      background: #F0FFF4;
      border-radius: 20px;
      padding: 3px 10px;
      font-size: 11px;
      color: var(--success);
    }

    /* Pet Profile */
    .pet-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      margin: 0 auto 12px;
      border: 3px solid var(--primary);
      overflow: hidden;
    }

    .pet-avatar img { width: 100%; height: 100%; object-fit: cover; }

    /* Tasuki Note */
    .note-section {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .note-section-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Support */
    .support-category {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    .cat-btn {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 12px;
      border: 1px solid var(--border);
      cursor: pointer;
      background: var(--white);
      font-family: 'Noto Sans JP', sans-serif;
      transition: all 0.2s;
    }

    .cat-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

    .support-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      margin-bottom: 10px;
    }

    .support-name { font-size: 14px; font-weight: 700; margin-bottom: 4px; }
    .support-area { font-size: 11px; color: var(--text-light); margin-bottom: 8px; }
    .support-links { display: flex; gap: 8px; }

    .link-btn {
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      border: 1px solid var(--primary);
      color: var(--primary);
      background: var(--white);
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
    }

    /* Simulator */
    .sim-result {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      border-radius: 14px;
      padding: 20px;
      text-align: center;
      margin-bottom: 12px;
    }

    .sim-amount {
      font-size: 32px;
      font-weight: 700;
      font-family: 'Poppins', sans-serif;
    }

    .sim-label { font-size: 12px; opacity: 0.9; margin-bottom: 4px; }

    .sim-breakdown {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
    }

    .sim-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid var(--border);
      font-size: 13px;
    }

    .sim-row:last-child { border-bottom: none; }

    /* Checklist */
    .check-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 8px;
      cursor: pointer;
    }

    .check-box {
      width: 22px;
      height: 22px;
      border: 2px solid var(--border);
      border-radius: 6px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .check-box.checked { background: var(--primary); border-color: var(--primary); }
    .check-text { font-size: 13px; }
    .check-sub { font-size: 11px; color: var(--text-light); margin-top: 2px; }

    /* Progress */
    .progress-bar {
      background: var(--border);
      border-radius: 20px;
      height: 8px;
      margin: 10px 0;
      overflow: hidden;
    }

    .progress-fill {
      background: var(--primary);
      height: 100%;
      border-radius: 20px;
      transition: width 0.5s;
    }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 200;
      align-items: flex-end;
    }

    .modal-overlay.active { display: flex; }

    .modal {
      background: var(--white);
      border-radius: 24px 24px 0 0;
      padding: 24px 20px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
      text-align: center;
    }

    .modal-close {
      position: absolute;
      top: 16px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-light);
      background: none;
      border: none;
    }

    /* Page Title */
    .page-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 16px;
      color: var(--text);
    }

    .page-subtitle {
      font-size: 13px;
      color: var(--text-light);
      margin-bottom: 16px;
    }

    /* Plan Badge */
    .plan-badge {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 20px;
      font-weight: 700;
      margin-left: 6px;
    }

    /* Tabs within page */
    .sub-tabs {
      display: flex;
      background: var(--accent);
      border-radius: 12px;
      padding: 4px;
      margin-bottom: 16px;
      gap: 4px;
    }

    .sub-tab {
      flex: 1;
      padding: 8px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 700;
      text-align: center;
      cursor: pointer;
      border: none;
      background: none;
      font-family: 'Noto Sans JP', sans-serif;
      color: var(--text-light);
      transition: all 0.2s;
    }

    .sub-tab.active { background: var(--white); color: var(--primary); }

    .sub-page { display: none; }
    .sub-page.active { display: block; }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-light);
    }

    .empty-state .empty-icon { font-size: 48px; margin-bottom: 12px; }
    .empty-state p { font-size: 14px; }

    /* Photo upload */
    .photo-upload {
      border: 2px dashed var(--border);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      color: var(--text-light);
      font-size: 13px;
    }

    .photo-upload:hover { border-color: var(--primary); background: var(--accent); }
    .photo-preview { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    .photo-thumb { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; }

    /* Section header */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .add-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 6px 14px;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      font-family: 'Noto Sans JP', sans-serif;
    }

    textarea.form-input { min-height: 80px; resize: vertical; }
  </style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="logo">
    <span class="logo-icon">ğŸ¾</span>
    <div>
      <div class="logo-text">Tasuki <span>ã‚¿ã‚¹ã‚­</span></div>
    </div>
  </div>
  <div class="tagline">å¤§åˆ‡ãªå‘½ã‚’ã€æ¬¡ã¸ã¤ãªãã€‚</div>
</div>

<!-- Pages -->

<!-- HOME -->
<div class="page active" id="page-home">
  <div id="alert-area"></div>

  <button class="sos-btn" onclick="switchPage('sos')">
    âš ï¸ SOS ç·Šæ€¥ç›¸è«‡
  </button>

  <div class="card" id="pet-summary">
    <div class="card-title">ãƒšãƒƒãƒˆã®æƒ…å ±</div>
    <div id="pet-summary-content">
      <div style="text-align:center;padding:12px;color:var(--text-light);font-size:13px;" onclick="switchPage('pet')">
        ãƒšãƒƒãƒˆæƒ…å ±ã‚’ç™»éŒ²ã—ã¾ã—ã‚‡ã† â†’
      </div>
    </div>
  </div>

  <div class="quick-grid">
    <div class="quick-item" onclick="switchPage('health')">
      <div class="icon">â¤ï¸</div>
      <div class="label">å¥åº·è¨˜éŒ²ã‚’ã¤ã‘ã‚‹</div>
      <div class="sub">æ—¥ã€…ã®ä½“èª¿ç®¡ç†</div>
    </div>
    <div class="quick-item" onclick="switchPage('note')">
      <div class="icon">ğŸ“–</div>
      <div class="label">ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆã‚’æ›¸ã</div>
      <div class="sub">å¤§åˆ‡ãªæƒ³ã„ã‚’æ®‹ã™</div>
    </div>
    <div class="quick-item" onclick="switchPage('pet')">
      <div class="icon">ğŸ¶</div>
      <div class="label">ãƒšãƒƒãƒˆæƒ…å ±ã‚’ç·¨é›†</div>
      <div class="sub">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†</div>
    </div>
    <div class="quick-item" onclick="switchPage('support')">
      <div class="icon">ğŸ”</div>
      <div class="label">ã‚µãƒãƒ¼ãƒˆã‚’æ¢ã™</div>
      <div class="sub">æ”¯æ´æƒ…å ±ãƒ»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
    </div>
  </div>
</div>

<!-- SOS -->
<div class="page" id="page-sos">
  <div class="page-title">SOSç›¸è«‡</div>
  <div class="page-subtitle">é£¼ã„ç¶šã‘ã‚‹ã“ã¨ãŒä¸å®‰ã§ã™ã‹ï¼Ÿã¾ãšç›¸è«‡ã‚’ã€‚</div>

  <div id="sos-list">
    <div class="situation-card" onclick="showSolution('moving')">
      <span class="sit-icon">ğŸ </span>
      <span class="sit-text">å¼•è¶Šã—å…ˆãŒãƒšãƒƒãƒˆä¸å¯</span>
    </div>
    <div class="situation-card" onclick="showSolution('money')">
      <span class="sit-icon">ğŸ’°</span>
      <span class="sit-text">çµŒæ¸ˆçš„ã«è‹¦ã—ããªã£ãŸ</span>
    </div>
    <div class="situation-card" onclick="showSolution('allergy')">
      <span class="sit-icon">ğŸ¤§</span>
      <span class="sit-text">å®¶æ—ãŒã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã«ãªã£ãŸ</span>
    </div>
    <div class="situation-card" onclick="showSolution('hospital')">
      <span class="sit-icon">ğŸ¥</span>
      <span class="sit-text">å…¥é™¢ãƒ»ä»‹è­·ãŒå¿…è¦ã«ãªã£ãŸ</span>
    </div>
    <div class="situation-card" onclick="showSolution('baby')">
      <span class="sit-icon">ğŸ‘¶</span>
      <span class="sit-text">å‡ºç”£ãƒ»è‚²å…ã§æ‰‹ãŒå›ã‚‰ãªã„</span>
    </div>
    <div class="situation-card" onclick="showSolution('different')">
      <span class="sit-icon">ğŸ˜”</span>
      <span class="sit-text">æ€ã£ã¦ã„ãŸé£¼è‚²ã¨é•ã£ãŸ</span>
    </div>
    <div class="situation-card" onclick="showSolution('other')">
      <span class="sit-icon">â“</span>
      <span class="sit-text">ãã®ä»–</span>
    </div>
  </div>

  <div id="solution-area"></div>
</div>

<!-- PET PROFILE -->
<div class="page" id="page-pet">
  <div class="page-title">ãƒšãƒƒãƒˆæƒ…å ±</div>

  <div class="card">
    <div class="pet-avatar" id="pet-avatar-display">ğŸ¶</div>
    <div class="form-group">
      <label class="form-label">ğŸ“· å†™çœŸ</label>
      <div class="photo-upload" onclick="document.getElementById('pet-photo-input').click()">
        ã‚¿ãƒƒãƒ—ã—ã¦å†™çœŸã‚’è¿½åŠ 
        <input type="file" id="pet-photo-input" accept="image/*" style="display:none" onchange="setPetPhoto(event)">
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">åå‰ *</label>
      <input type="text" class="form-input" id="pet-name" placeholder="ä¾‹ï¼šãƒãƒ">
    </div>
    <div class="form-group">
      <label class="form-label">ç¨®é¡</label>
      <select class="form-select" id="pet-species">
        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
        <option value="dog">çŠ¬</option>
        <option value="cat">çŒ«</option>
        <option value="other">ãã®ä»–</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">çŠ¬ç¨®ãƒ»çŒ«ç¨®</label>
      <input type="text" class="form-input" id="pet-breed" placeholder="ä¾‹ï¼šæŸ´çŠ¬ã€ãƒˆã‚¤ãƒ—ãƒ¼ãƒ‰ãƒ«">
    </div>
    <div class="form-group">
      <label class="form-label">å¹´é½¢</label>
      <input type="number" class="form-input" id="pet-age" placeholder="ä¾‹ï¼š3">
    </div>
    <div class="form-group">
      <label class="form-label">æ€§åˆ¥</label>
      <select class="form-select" id="pet-gender">
        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
        <option value="male">ã‚ªã‚¹</option>
        <option value="female">ãƒ¡ã‚¹</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">æ€§æ ¼ãƒ»ç‰¹å¾´</label>
      <textarea class="form-input" id="pet-personality" placeholder="ä¾‹ï¼šäººæ‡ã£ã“ã„ã€æ•£æ­©ãŒå¤§å¥½ã"></textarea>
    </div>
    <div class="form-group">
      <label class="form-label">å¥½ããªé£Ÿã¹ç‰©</label>
      <input type="text" class="form-input" id="pet-food" placeholder="ä¾‹ï¼šã•ã•ã¿ã€ã‚Šã‚“ã”">
    </div>
    <div class="form-group">
      <label class="form-label">è‹¦æ‰‹ãªã‚‚ã®</label>
      <input type="text" class="form-input" id="pet-fears" placeholder="ä¾‹ï¼šé›·ã€çŸ¥ã‚‰ãªã„äºº">
    </div>
    <div class="form-group">
      <label class="form-label">æ—¢å¾€æ­´ãƒ»ç—…æ°—</label>
      <textarea class="form-input" id="pet-medical" placeholder="ä¾‹ï¼šã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æ€§çš®è†šç‚ï¼ˆ2022å¹´è¨ºæ–­ï¼‰"></textarea>
    </div>
    <div class="form-group">
      <label class="form-label">ç¾åœ¨ã®è–¬</label>
      <input type="text" class="form-input" id="pet-meds" placeholder="ä¾‹ï¼šã‚¢ãƒã‚­ãƒ«éŒ ï¼ˆ1æ—¥1å›ï¼‰">
    </div>
    <div class="form-group">
      <label class="form-label">ãƒã‚¤ã‚¯ãƒ­ãƒãƒƒãƒ—ç•ªå·</label>
      <input type="text" class="form-input" id="pet-chip" placeholder="15æ¡ã®ç•ªå·">
    </div>
    <div class="form-group">
      <label class="form-label">ã‹ã‹ã‚Šã¤ã‘å‹•ç‰©ç—…é™¢</label>
      <input type="text" class="form-input" id="pet-vet" placeholder="ä¾‹ï¼šâ—‹â—‹å‹•ç‰©ç—…é™¢ï¼ˆ03-XXXX-XXXXï¼‰">
    </div>
    <button class="btn-primary" onclick="savePetProfile()">ğŸ’¾ ä¿å­˜ã™ã‚‹</button>
  </div>
</div>

<!-- HEALTH -->
<div class="page" id="page-health">
  <div class="page-title">å¥åº·è¨˜éŒ²</div>

  <div class="sub-tabs">
    <button class="sub-tab active" onclick="switchSubTab('health', 'record')">è¨˜éŒ²</button>
    <button class="sub-tab" onclick="switchSubTab('health', 'graph')">ã‚°ãƒ©ãƒ•</button>
    <button class="sub-tab" onclick="switchSubTab('health', 'vaccine')">ãƒ¯ã‚¯ãƒãƒ³ãƒ»æŠ•è–¬</button>
  </div>

  <!-- Record Sub -->
  <div class="sub-page active" id="health-sub-record">
    <button class="btn-primary" style="margin-bottom:16px" onclick="openHealthModal()">ï¼‹ ä»Šæ—¥ã®è¨˜éŒ²ã‚’ã¤ã‘ã‚‹</button>

    <div id="health-timeline">
      <div class="empty-state">
        <div class="empty-icon">ğŸ“‹</div>
        <p>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“<br>ä»Šæ—¥ã®è¨˜éŒ²ã‚’ã¤ã‘ã¾ã—ã‚‡ã†</p>
      </div>
    </div>
  </div>

  <!-- Graph Sub -->
  <div class="sub-page" id="health-sub-graph">
    <div class="chart-tabs">
      <button class="chart-tab active" onclick="switchChartRange(30, this)">30æ—¥</button>
      <button class="chart-tab" onclick="switchChartRange(90, this)">90æ—¥</button>
      <button class="chart-tab" onclick="switchChartRange(365, this)">1å¹´</button>
    </div>
    <div class="card">
      <div class="card-title">ä½“é‡æ¨ç§»ã‚°ãƒ©ãƒ•</div>
      <div class="chart-container">
        <canvas id="weightChart"></canvas>
      </div>
    </div>
    <div class="card">
      <div class="card-title">PDFå‡ºåŠ› <span class="plan-badge">PREMIUM</span></div>
      <p style="font-size:13px;color:var(--text-light);margin-bottom:12px">ç£åŒ»ã¸ã®è¨ºå¯Ÿæ™‚ã«ä½¿ãˆã‚‹å¥åº·è¨˜éŒ²PDFã‚’å‡ºåŠ›ã§ãã¾ã™</p>
      <button class="btn-secondary" onclick="alert('ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ï¼ˆæœˆé¡1,480å††ï¼‰ã§ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™')">ğŸ“„ PDFå‡ºåŠ›ã™ã‚‹</button>
    </div>
  </div>

  <!-- Vaccine Sub -->
  <div class="sub-page" id="health-sub-vaccine">
    <div class="section-header">
      <div class="card-title" style="margin:0">ãƒ¯ã‚¯ãƒãƒ³ãƒ»æ¥ç¨®è¨˜éŒ²</div>
      <button class="add-btn" onclick="openVaccineModal()">ï¼‹ è¿½åŠ </button>
    </div>

    <div id="vaccine-list">
      <div class="vaccine-item">
        <div>
          <div class="vaccine-name">æ··åˆãƒ¯ã‚¯ãƒãƒ³ï¼ˆ5ç¨®ï¼‰</div>
          <div class="vaccine-date">æ¬¡å›ï¼š2026å¹´4æœˆ1æ—¥</div>
        </div>
        <span class="vaccine-alert">âš ï¸ 40æ—¥å¾Œ</span>
      </div>
      <div class="vaccine-item">
        <div>
          <div class="vaccine-name">ç‹‚çŠ¬ç—…äºˆé˜²æ¥ç¨®</div>
          <div class="vaccine-date">æ¬¡å›ï¼š2026å¹´6æœˆ1æ—¥</div>
        </div>
        <span class="vaccine-ok">âœ“ ä½™è£•ã‚ã‚Š</span>
      </div>
    </div>

    <div class="section-header" style="margin-top:20px">
      <div class="card-title" style="margin:0">æŠ•è–¬ç®¡ç†</div>
      <button class="add-btn" onclick="openMedModal()">ï¼‹ è¿½åŠ </button>
    </div>

    <div id="med-list">
      <div class="empty-state" style="padding:20px">
        <p>æŠ•è–¬è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>
      </div>
    </div>
  </div>
</div>

<!-- TASUKI NOTE -->
<div class="page" id="page-note">
  <div class="page-title">ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆ</div>
  <div class="page-subtitle">ã‚‚ã—ã‚‚ã®æ™‚ã®ãŸã‚ã«ã€å¤§åˆ‡ãªæƒ³ã„ã‚’æ®‹ã™</div>

  <div class="note-section">
    <div class="note-section-title">ğŸ¾ ãƒšãƒƒãƒˆã¸ã®æƒ³ã„ãƒ»ãŠé¡˜ã„</div>
    <div class="form-group">
      <textarea class="form-input" id="note-message" placeholder="æ¬¡ã®é£¼ã„ä¸»ã•ã‚“ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›¸ã„ã¦ãã ã•ã„..." style="min-height:100px"></textarea>
    </div>
  </div>

  <div class="note-section">
    <div class="note-section-title">ğŸ‘¤ æ¬¡ã®é£¼ã„ä¸»å€™è£œ</div>
    <div class="form-group">
      <label class="form-label">åå‰</label>
      <input type="text" class="form-input" id="note-next-owner" placeholder="ä¾‹ï¼šç”°ä¸­ èŠ±å­">
    </div>
    <div class="form-group">
      <label class="form-label">é€£çµ¡å…ˆ</label>
      <input type="text" class="form-input" id="note-next-contact" placeholder="ä¾‹ï¼š090-XXXX-XXXX">
    </div>
    <div class="form-group">
      <label class="form-label">ç¶šæŸ„ãƒ»é–¢ä¿‚</label>
      <input type="text" class="form-input" id="note-next-relation" placeholder="ä¾‹ï¼šå¦¹ã€å‹äºº">
    </div>
  </div>

  <div class="note-section">
    <div class="note-section-title">ğŸ“‹ æ—¥å¸¸ã®ã‚±ã‚¢æƒ…å ±</div>
    <div class="form-group">
      <label class="form-label">é£Ÿäº‹ã®å†…å®¹ãƒ»æ™‚é–“</label>
      <textarea class="form-input" id="note-feeding" placeholder="ä¾‹ï¼šæœ7æ™‚ãƒ»å¤œ6æ™‚ã«ã€‡ã€‡ãƒ•ãƒ¼ãƒ‰100gãšã¤"></textarea>
    </div>
    <div class="form-group">
      <label class="form-label">æ•£æ­©ã®é »åº¦ãƒ»ã‚³ãƒ¼ã‚¹</label>
      <textarea class="form-input" id="note-walk" placeholder="ä¾‹ï¼šæœæ™©30åˆ†ã€è¿‘ãã®å…¬åœ’ã¸"></textarea>
    </div>
    <div class="form-group">
      <label class="form-label">æ³¨æ„äº‹é …ãƒ»ç¦æ­¢äº‹é …</label>
      <textarea class="form-input" id="note-caution" placeholder="ä¾‹ï¼šãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆNGã€çŸ¥ã‚‰ãªã„äººã«ã¯å ãˆã¾ã™"></textarea>
    </div>
  </div>

  <div class="note-section">
    <div class="note-section-title">ğŸ’° æœˆã€…ã®è²»ç”¨ç›®å®‰</div>
    <div class="form-group">
      <label class="form-label">ãƒ•ãƒ¼ãƒ‰ä»£ï¼ˆæœˆï¼‰</label>
      <input type="number" class="form-input" id="note-cost-food" placeholder="ä¾‹ï¼š8000">
    </div>
    <div class="form-group">
      <label class="form-label">åŒ»ç™‚è²»ï¼ˆæœˆå¹³å‡ï¼‰</label>
      <input type="number" class="form-input" id="note-cost-medical" placeholder="ä¾‹ï¼š5000">
    </div>
    <div class="form-group">
      <label class="form-label">ãã®ä»–ï¼ˆãƒˆãƒªãƒŸãƒ³ã‚°ç­‰ï¼‰</label>
      <input type="number" class="form-input" id="note-cost-other" placeholder="ä¾‹ï¼š5000">
    </div>
  </div>

  <button class="btn-primary" onclick="saveNote()">ğŸ’¾ ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆã‚’ä¿å­˜ã™ã‚‹</button>
  <button class="btn-secondary" onclick="shareNote()">ğŸ”— ä¿¡é ¼ã§ãã‚‹äººã«å…±æœ‰ã™ã‚‹</button>
</div>

<!-- SUPPORT -->
<div class="page" id="page-support">
  <div class="page-title">ã‚µãƒãƒ¼ãƒˆæƒ…å ±</div>

  <div class="sub-tabs">
    <button class="sub-tab active" onclick="switchSubTab('support', 'info')">æ”¯æ´æƒ…å ±</button>
    <button class="sub-tab" onclick="switchSubTab('support', 'sim')">è²»ç”¨è©¦ç®—</button>
    <button class="sub-tab" onclick="switchSubTab('support', 'check')">æº–å‚™ç¢ºèª</button>
  </div>

  <!-- Support Info -->
  <div class="sub-page active" id="support-sub-info">
    <div class="support-category">
      <button class="cat-btn active" onclick="filterSupport('all', this)">ã™ã¹ã¦</button>
      <button class="cat-btn" onclick="filterSupport('food', this)">ğŸš ãƒ•ãƒ¼ãƒ‰ãƒãƒ³ã‚¯</button>
      <button class="cat-btn" onclick="filterSupport('vet', this)">ğŸ¥ ä½ä¾¡æ ¼ç—…é™¢</button>
      <button class="cat-btn" onclick="filterSupport('foster', this)">ğŸ  ä¸€æ™‚é ã‹ã‚Š</button>
      <button class="cat-btn" onclick="filterSupport('legal', this)">âš–ï¸ æ³•å¾‹ç›¸è«‡</button>
    </div>

    <div id="support-list">
      <div class="support-card" data-cat="foster">
        <div class="support-name">å‹•ç‰©æ„›è­·å¸‚æ°‘å›£ä½“ JCDL</div>
        <div class="support-area">ğŸŒ å…¨å›½å¯¾å¿œãƒ»365æ—¥ãƒ»é€è¿ã‚ã‚Š</div>
        <div style="font-size:12px;color:var(--text-light);margin-bottom:8px">å¼•è¶Šã—ãƒ»å…¥é™¢ãƒ»è‚²å…ãªã©ç†ç”±ã‚’å•ã‚ãšä¸€æ™‚é ã‹ã‚Šå¯¾å¿œ</div>
        <div class="support-links">
          <a class="link-btn" href="https://jcdl.jp" target="_blank">ğŸŒ ã‚µã‚¤ãƒˆã‚’è¦‹ã‚‹</a>
        </div>
      </div>

      <div class="support-card" data-cat="foster">
        <div class="support-name">å…¬ç›Šè²¡å›£æ³•äºº æ—¥æœ¬å‹•ç‰©æ„›è­·å”ä¼š</div>
        <div class="support-area">ğŸŒ å…¨å›½</div>
        <div style="font-size:12px;color:var(--text-light);margin-bottom:8px">ãƒšãƒƒãƒˆã«é–¢ã™ã‚‹ç›¸è«‡ãƒ»æ”¯æ´å…¨èˆ¬</div>
        <div class="support-links">
          <a class="link-btn" href="https://jspca.or.jp" target="_blank">ğŸŒ ã‚µã‚¤ãƒˆã‚’è¦‹ã‚‹</a>
        </div>
      </div>

      <div class="support-card" data-cat="food">
        <div class="support-name">ãƒšãƒƒãƒˆã®ãƒ•ãƒ¼ãƒ‰ãƒãƒ³ã‚¯ï¼ˆåœ°åŸŸåˆ¥ï¼‰</div>
        <div class="support-area">ğŸ“ å„éƒ½é“åºœçœŒ</div>
        <div style="font-size:12px;color:var(--text-light);margin-bottom:8px">çµŒæ¸ˆçš„ã«å›°çª®ã—ãŸé£¼ã„ä¸»ã¸ã®ãƒ•ãƒ¼ãƒ‰ç„¡æ–™æä¾›</div>
        <div class="support-links">
          <a class="link-btn" href="https://www.google.com/search?q=ãƒšãƒƒãƒˆãƒ•ãƒ¼ãƒ‰ãƒãƒ³ã‚¯+åœ°åŸŸ" target="_blank">ğŸ” è¿‘ãã‚’æ¢ã™</a>
        </div>
      </div>

      <div class="support-card" data-cat="legal">
        <div class="support-name">ãƒšãƒƒãƒˆä¿¡è¨—å¯¾å¿œ æ³•å¾‹äº‹å‹™æ‰€</div>
        <div class="support-area">ğŸŒ å…¨å›½ï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç›¸è«‡å¯ï¼‰</div>
        <div style="font-size:12px;color:var(--text-light);margin-bottom:8px">é£¼ã„ä¸»ãŒäº¡ããªã£ãŸå¾Œã®ãƒšãƒƒãƒˆã®ç”Ÿæ´»ã‚’æ³•çš„ã«ä¿è­·</div>
        <div class="support-links">
          <a class="link-btn" href="https://www.google.com/search?q=ãƒšãƒƒãƒˆä¿¡è¨—+æ³•å¾‹äº‹å‹™æ‰€" target="_blank">ğŸ” æ¢ã™</a>
        </div>
      </div>

      <div class="support-card" data-cat="foster">
        <div class="support-name">ãƒšãƒƒãƒˆã®ãŠã†ã¡ï¼ˆé‡Œè¦ªãƒãƒƒãƒãƒ³ã‚°ï¼‰</div>
        <div class="support-area">ğŸŒ å…¨å›½</div>
        <div style="font-size:12px;color:var(--text-light);margin-bottom:8px">æ–°ã—ã„é£¼ã„ä¸»ã‚’æ¢ã™ãŸã‚ã®ãƒãƒƒãƒãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹</div>
        <div class="support-links">
          <a class="link-btn" href="https://www.pet-home.jp" target="_blank">ğŸŒ ã‚µã‚¤ãƒˆã‚’è¦‹ã‚‹</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Simulator -->
  <div class="sub-page" id="support-sub-sim">
    <div class="card">
      <div class="card-title">ğŸ§® é£¼è‚²è²»ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
      <p style="font-size:12px;color:var(--text-light);margin-bottom:14px">é£¼ã„å§‹ã‚ã‚‹å‰ã«ã€10å¹´é–“ã®è²»ç”¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†</p>

      <div class="form-group">
        <label class="form-label">ç¨®é¡</label>
        <select class="form-select" id="sim-species" onchange="calcSim()">
          <option value="dog-s">çŠ¬ï¼ˆå°å‹ï¼‰</option>
          <option value="dog-m">çŠ¬ï¼ˆä¸­å‹ï¼‰</option>
          <option value="dog-l">çŠ¬ï¼ˆå¤§å‹ï¼‰</option>
          <option value="cat">çŒ«</option>
        </select>
      </div>

      <div id="sim-result" style="margin-top:16px">
        <div class="sim-result">
          <div class="sim-label">æœˆã€…ã®è²»ç”¨ç›®å®‰</div>
          <div class="sim-amount" id="sim-monthly">Â¥25,000</div>
          <div style="margin-top:8px;font-size:12px;opacity:0.8">å¹´é–“ <span id="sim-yearly">ç´„300,000å††</span></div>
          <div style="font-size:12px;opacity:0.8">10å¹´é–“ <span id="sim-total">ç´„3,000,000å††</span></div>
        </div>

        <div class="sim-breakdown">
          <div class="sim-row"><span>ğŸš ãƒ•ãƒ¼ãƒ‰ä»£</span><span id="sim-food">æœˆ8,000å††</span></div>
          <div class="sim-row"><span>ğŸ¥ åŒ»ç™‚è²»</span><span id="sim-medical">æœˆ7,000å††</span></div>
          <div class="sim-row"><span>âœ‚ï¸ ãƒˆãƒªãƒŸãƒ³ã‚°</span><span id="sim-trim">æœˆ3,000å††</span></div>
          <div class="sim-row"><span>ğŸ›¡ï¸ ãƒšãƒƒãƒˆä¿é™º</span><span id="sim-insurance">æœˆ4,000å††</span></div>
          <div class="sim-row"><span>ğŸ›’ æ¶ˆè€—å“</span><span id="sim-supplies">æœˆ3,000å††</span></div>
        </div>
      </div>
    </div>

    <!-- Lifecycle -->
    <div class="card">
      <div class="card-title">ğŸ“… ãƒ©ã‚¤ãƒ•ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
      <div class="timeline-item">
        <div class="timeline-date">ğŸ£ å­çŠ¬ãƒ»å­çŒ«æœŸï¼ˆ0ã€œ1æ­³ï¼‰</div>
        <div style="font-size:13px">ãƒ¯ã‚¯ãƒãƒ³æ¥ç¨®3å›ãƒ»å»å‹¢/é¿å¦Šæ‰‹è¡“ãƒ»ãƒã‚¤ã‚¯ãƒ­ãƒãƒƒãƒ—ç™»éŒ²ãƒ»ã—ã¤ã‘æ•™å®¤</div>
      </div>
      <div class="timeline-item">
        <div class="timeline-date">ğŸ• æˆçŠ¬ãƒ»æˆçŒ«æœŸï¼ˆ1ã€œ7æ­³ï¼‰</div>
        <div style="font-size:13px">å¹´1å›ãƒ¯ã‚¯ãƒãƒ³ãƒ»ç‹‚çŠ¬ç—…äºˆé˜²æ¥ç¨®ï¼ˆçŠ¬ï¼‰ãƒ»å¹´1å›å¥åº·è¨ºæ–­ãƒ»æ­¯çŸ³é™¤å»</div>
      </div>
      <div class="timeline-item">
        <div class="timeline-date">ğŸ¾ ã‚·ãƒ‹ã‚¢æœŸï¼ˆ7æ­³ã€œï¼‰</div>
        <div style="font-size:13px">å¹´2å›å¥åº·è¨ºæ–­ãƒ»é–¢ç¯€ã‚±ã‚¢ãƒ»ã‚·ãƒ‹ã‚¢ãƒ•ãƒ¼ãƒ‰ã¸åˆ‡æ›¿ãƒ»æŠ•è–¬ç®¡ç†å¼·åŒ–</div>
      </div>
    </div>
  </div>

  <!-- Checklist -->
  <div class="sub-page" id="support-sub-check">
    <div class="card">
      <div class="card-title">âœ… é£¼è‚²æº–å‚™ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</div>
      <p style="font-size:12px;color:var(--text-light);margin-bottom:14px">é£¼ã„å§‹ã‚ã‚‹å‰ã«ç¢ºèªã—ã¾ã—ã‚‡ã†</p>

      <div class="progress-bar">
        <div class="progress-fill" id="check-progress" style="width:0%"></div>
      </div>
      <div style="text-align:right;font-size:12px;color:var(--text-light);margin-bottom:14px" id="check-count">0 / 8 å®Œäº†</div>

      <div id="checklist">
        <div class="check-item" onclick="toggleCheck(this)">
          <div class="check-box"></div>
          <div>
            <div class="check-text">ä½ç’°å¢ƒã®ç¢ºèª</div>
            <div class="check-sub">ãƒšãƒƒãƒˆå¯ã®ä½å±…ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸ</div>
          </div>
        </div>
        <div class="check-item" onclick="toggleCheck(this)">
          <div class="check-box"></div>
          <div>
            <div class="check-text">å®¶æ—å…¨å“¡ã®åŒæ„</div>
            <div class="check-sub">åŒå±…ã™ã‚‹å…¨å“¡ãŒãƒšãƒƒãƒˆã‚’è¿ãˆã‚‹ã“ã¨ã«è³›æˆã—ã¦ã„ã‚‹</div>
          </div>
        </div>
        <div class="check-item" onclick="toggleCheck(this)">
          <div class="check-box"></div>
          <div>
            <div class="check-text">ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã®ç¢ºèª</div>
            <div class="check-sub">å®¶æ—å…¨å“¡ãŒã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æ¤œæŸ»ã¾ãŸã¯ç¢ºèªã‚’æ¸ˆã¾ã›ãŸ</div>
          </div>
        </div>
        <div class="check-item" onclick="toggleCheck(this)">
          <div class="check-box"></div>
          <div>
            <div class="check-text">çµŒæ¸ˆçš„ãªä½™è£•</div>
            <div class="check-sub">æœˆ2ã€œ5ä¸‡å††ã®é£¼è‚²è²»ã‚’10å¹´ä»¥ä¸Šè² æ‹…ã§ãã‚‹</div>
          </div>
        </div>
        <div class="check-item" onclick="toggleCheck(this)">
          <div class="check-box"></div>
          <div>
            <div class="check-text">æ™‚é–“çš„ãªä½™è£•</div>
            <div class="check-sub">æ¯æ—¥ã®ãŠä¸–è©±ãƒ»æ•£æ­©ã®æ™‚é–“ãŒç¢ºä¿ã§ãã‚‹</div>
          </div>
        </div>
        <div class="check-item" onclick="toggleCheck(this)">
          <div class="check-box"></div>
          <div>
            <div class="check-text">ç·Šæ€¥æ™‚ã®å¯¾å¿œè€…</div>
            <div class="check-sub">è‡ªåˆ†ãŒå…¥é™¢ã—ãŸå ´åˆã«é ã‹ã£ã¦ãã‚Œã‚‹äººãŒã„ã‚‹</div>
          </div>
        </div>
        <div class="check-item" onclick="toggleCheck(this)">
          <div class="check-box"></div>
          <div>
            <div class="check-text">ã‹ã‹ã‚Šã¤ã‘ç—…é™¢ã®ç¢ºèª</div>
            <div class="check-sub">è¿‘ãã®å‹•ç‰©ç—…é™¢ã‚’èª¿ã¹ã¦é€£çµ¡å…ˆã‚’æŠŠæ¡ã—ã¦ã„ã‚‹</div>
          </div>
        </div>
        <div class="check-item" onclick="toggleCheck(this)">
          <div class="check-box"></div>
          <div>
            <div class="check-text">ãƒšãƒƒãƒˆä¿é™ºã®æ¤œè¨</div>
            <div class="check-sub">åŒ»ç™‚è²»ã®å‚™ãˆã¨ã—ã¦ãƒšãƒƒãƒˆä¿é™ºã‚’æ¤œè¨ã—ãŸ</div>
          </div>
        </div>
      </div>

      <div id="check-result" style="display:none;margin-top:16px">
        <div style="background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white;border-radius:14px;padding:16px;text-align:center">
          <div style="font-size:24px;margin-bottom:4px">ğŸ‰</div>
          <div style="font-weight:700;font-size:16px">æº–å‚™å®Œäº†ï¼</div>
          <div style="font-size:12px;opacity:0.9;margin-top:4px">ãƒšãƒƒãƒˆã‚’è¿ãˆã‚‹æº–å‚™ãŒæ•´ã„ã¾ã—ãŸ</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bottom Nav -->
<nav class="bottom-nav">
  <button class="nav-item active" onclick="switchPage('home')" id="nav-home">
    <span class="nav-icon">ğŸ </span>ãƒ›ãƒ¼ãƒ 
  </button>
  <button class="nav-item" onclick="switchPage('sos')" id="nav-sos">
    <span class="nav-icon">âš ï¸</span>SOSç›¸è«‡
  </button>
  <button class="nav-item" onclick="switchPage('pet')" id="nav-pet">
    <span class="nav-icon">ğŸ¾</span>ãƒšãƒƒãƒˆæƒ…å ±
  </button>
  <button class="nav-item" onclick="switchPage('health')" id="nav-health">
    <span class="nav-icon">â¤ï¸</span>å¥åº·è¨˜éŒ²
  </button>
  <button class="nav-item" onclick="switchPage('note')" id="nav-note">
    <span class="nav-icon">ğŸ“–</span>ãƒãƒ¼ãƒˆ
  </button>
  <button class="nav-item" onclick="switchPage('support')" id="nav-support">
    <span class="nav-icon">ğŸ”</span>ã‚µãƒãƒ¼ãƒˆ
  </button>
</nav>

<!-- Health Input Modal -->
<div class="modal-overlay" id="health-modal">
  <div class="modal" style="position:relative">
    <button class="modal-close" onclick="closeModal('health-modal')">Ã—</button>
    <div class="modal-title">ä»Šæ—¥ã®å¥åº·è¨˜éŒ²</div>

    <div class="form-group">
      <label class="form-label">ä½“é‡ (kg)</label>
      <input type="number" class="form-input" id="h-weight" placeholder="ä¾‹ï¼š5.2" step="0.1">
    </div>

    <div class="form-group">
      <label class="form-label">é£Ÿæ¬²</label>
      <div class="icon-selector">
        <div class="icon-opt" onclick="selectOpt(this,'appetite','good')">
          <span class="opt-icon">ğŸ˜‹</span>è‰¯ã„
        </div>
        <div class="icon-opt" onclick="selectOpt(this,'appetite','normal')">
          <span class="opt-icon">ğŸ˜</span>æ™®é€š
        </div>
        <div class="icon-opt" onclick="selectOpt(this,'appetite','bad')">
          <span class="opt-icon">ğŸ˜</span>æ‚ªã„
        </div>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">é‹å‹•é‡</label>
      <div class="icon-selector">
        <div class="icon-opt" onclick="selectOpt(this,'activity','good')">
          <span class="opt-icon">ğŸƒ</span>æ´»ç™º
        </div>
        <div class="icon-opt" onclick="selectOpt(this,'activity','normal')">
          <span class="opt-icon">ğŸš¶</span>æ™®é€š
        </div>
        <div class="icon-opt" onclick="selectOpt(this,'activity','bad')">
          <span class="opt-icon">ğŸ˜´</span>å°‘ãªã„
        </div>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">ä¾¿ã®çŠ¶æ…‹</label>
      <div class="icon-selector">
        <div class="icon-opt" onclick="selectOpt(this,'stool','good')">
          <span class="opt-icon">âœ…</span>è‰¯å¥½
        </div>
        <div class="icon-opt" onclick="selectOpt(this,'stool','soft')">
          <span class="opt-icon">âš ï¸</span>è»Ÿä¾¿
        </div>
        <div class="icon-opt" onclick="selectOpt(this,'stool','bad')">
          <span class="opt-icon">ğŸš¨</span>ä¸‹ç—¢
        </div>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">å†™çœŸï¼ˆæœ€å¤§3æšï¼‰</label>
      <div class="photo-upload" onclick="document.getElementById('health-photo').click()">
        ğŸ“· ã‚¿ãƒƒãƒ—ã—ã¦å†™çœŸã‚’è¿½åŠ 
        <input type="file" id="health-photo" accept="image/*" multiple style="display:none" onchange="previewHealthPhotos(event)">
      </div>
      <div class="photo-preview" id="health-photo-preview"></div>
    </div>

    <div class="form-group">
      <label class="form-label">ãƒ¡ãƒ¢</label>
      <textarea class="form-input" id="h-memo" placeholder="æ°—ã«ãªã£ãŸã“ã¨ã‚’è¨˜éŒ²ã—ã¦ãŠãã¾ã—ã‚‡ã†"></textarea>
    </div>

    <button class="btn-primary" onclick="saveHealthRecord()">ğŸ’¾ è¨˜éŒ²ã‚’ä¿å­˜ã™ã‚‹</button>
  </div>
</div>

<script>
// State
let state = {
  currentPage: 'home',
  petProfile: JSON.parse(localStorage.getItem('tasuki-pet') || 'null'),
  healthRecords: JSON.parse(localStorage.getItem('tasuki-health') || '[]'),
  vaccines: JSON.parse(localStorage.getItem('tasuki-vaccines') || '[]'),
  note: JSON.parse(localStorage.getItem('tasuki-note') || 'null'),
  selectedOpts: { appetite: '', activity: '', stool: '' },
  weightChart: null,
  chartRange: 30
};

// Solutions data
const solutions = {
  moving: {
    title: 'å¼•è¶Šã—å…ˆãŒãƒšãƒƒãƒˆä¸å¯',
    items: ['ãƒšãƒƒãƒˆå¯ç‰©ä»¶ã¸ã®å¼•è¶Šã—ã‚’æ¤œè¨ã™ã‚‹ï¼ˆãƒšãƒƒãƒˆå¯ç‰©ä»¶ã‚µã‚¤ãƒˆã§æ¤œç´¢ï¼‰','å¤§å®¶ã•ã‚“ã¸äº¤æ¸‰ã™ã‚‹ï¼ˆæ•·é‡‘å¢—é¡ã‚’ææ¡ˆã™ã‚‹ï¼‰','ãƒšãƒƒãƒˆå¯ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ç‰©ä»¶ã«å…ˆã«ç”³ã—è¾¼ã‚€','ä¸€æ™‚çš„ã«ä¿¡é ¼ã§ãã‚‹äººã«é ã‘ã‚‹'],
    orgs: [{ name: 'ãƒšãƒƒãƒˆå¯ç‰©ä»¶æ¤œç´¢ï¼ˆSUUMOï¼‰', url: 'https://suumo.jp/chintai/soba/tokyo/kw-pet/' }, { name: 'å‹•ç‰©æ„›è­·å¸‚æ°‘å›£ä½“JCDLï¼ˆä¸€æ™‚é ã‹ã‚Šï¼‰', url: 'https://jcdl.jp' }]
  },
  money: {
    title: 'çµŒæ¸ˆçš„ã«è‹¦ã—ããªã£ãŸ',
    items: ['ãƒšãƒƒãƒˆãƒ•ãƒ¼ãƒ‰ãƒãƒ³ã‚¯ã‚’åˆ©ç”¨ã™ã‚‹ï¼ˆç„¡æ–™ã§é£Ÿæ–™æ”¯æ´ï¼‰','ä½ä¾¡æ ¼å‹•ç‰©ç—…é™¢ã‚’åˆ©ç”¨ã™ã‚‹','ãƒšãƒƒãƒˆä¿é™ºã®è¦‹ç›´ã—ã‚’ã™ã‚‹','è‡ªæ²»ä½“ã®ç”Ÿæ´»æ”¯æ´ç›¸è«‡çª“å£ã¸ç›¸è«‡ã™ã‚‹'],
    orgs: [{ name: 'ãƒšãƒƒãƒˆãƒ•ãƒ¼ãƒ‰ãƒãƒ³ã‚¯ï¼ˆåœ°åŸŸåˆ¥ï¼‰', url: 'https://www.google.com/search?q=ãƒšãƒƒãƒˆãƒ•ãƒ¼ãƒ‰ãƒãƒ³ã‚¯+è¿‘ã' }, { name: 'ä½ä¾¡æ ¼å‹•ç‰©ç—…é™¢ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', url: 'https://www.google.com/search?q=ä½ä¾¡æ ¼+å‹•ç‰©ç—…é™¢+è¿‘ã' }, { name: 'ç¤¾ä¼šç¦ç¥‰å”è­°ä¼š', url: 'https://www.google.com/search?q=ç¤¾ä¼šç¦ç¥‰å”è­°ä¼š+è¿‘ã' }]
  },
  allergy: {
    title: 'å®¶æ—ãŒã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã«ãªã£ãŸ',
    items: ['ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å°‚é–€åŒ»ã«ç›¸è«‡ã™ã‚‹ï¼ˆè»½ç—‡ãªã‚‰è–¬ã§å¯¾å¿œå¯èƒ½ãªã‚±ãƒ¼ã‚¹ã‚‚ï¼‰','ç©ºæ°—æ¸…æµ„æ©Ÿã®è¨­ç½®ãƒ»ã“ã¾ã‚ãªæƒé™¤ãƒ»ãƒšãƒƒãƒˆã®éƒ¨å±‹ã‚’åˆ†ã‘ã‚‹','ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³å…ç–«ç™‚æ³•ï¼ˆæ¸›æ„Ÿä½œç™‚æ³•ï¼‰ã‚’æ¤œè¨ã™ã‚‹','ã©ã†ã—ã¦ã‚‚ç„¡ç†ãªå ´åˆã¯æ¬¡ã®é£¼ã„ä¸»ã‚’æ¢ã™'],
    orgs: [{ name: 'ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å°‚é–€å¤–æ¥ï¼ˆæ¤œç´¢ï¼‰', url: 'https://www.google.com/search?q=ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å°‚é–€+å¤–æ¥+è¿‘ã' }, { name: 'ãƒšãƒƒãƒˆã®ãŠã†ã¡ï¼ˆé‡Œè¦ªï¼‰', url: 'https://www.pet-home.jp' }]
  },
  hospital: {
    title: 'å…¥é™¢ãƒ»ä»‹è­·ãŒå¿…è¦ã«ãªã£ãŸ',
    items: ['ãƒšãƒƒãƒˆä¿¡è¨—ã‚’æ´»ç”¨ã™ã‚‹ï¼ˆæ³•çš„ã«å®‰å¿ƒï¼‰','ä¸€æ™‚é ã‹ã‚Šã‚µãƒ¼ãƒ“ã‚¹ã‚’æ‰‹é…ã™ã‚‹','ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆã«æ—¥å¸¸ã®ã‚±ã‚¢æƒ…å ±ã‚’è¨˜éŒ²ã—ã¦ãŠã','äº‹å‰ã«æ¬¡ã®é£¼ã„ä¸»å€™è£œã‚’ç™»éŒ²ã—ã¦ãŠã'],
    orgs: [{ name: 'å‹•ç‰©æ„›è­·å¸‚æ°‘å›£ä½“JCDLï¼ˆä¸€æ™‚é ã‹ã‚Šï¼‰', url: 'https://jcdl.jp' }, { name: 'ãƒšãƒƒãƒˆã‚·ãƒƒã‚¿ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆæ¤œç´¢ï¼‰', url: 'https://www.google.com/search?q=ãƒšãƒƒãƒˆã‚·ãƒƒã‚¿ãƒ¼+è¿‘ã' }, { name: 'ãƒšãƒƒãƒˆä¿¡è¨—å¯¾å¿œ æ³•å¾‹äº‹å‹™æ‰€', url: 'https://www.google.com/search?q=ãƒšãƒƒãƒˆä¿¡è¨—+æ³•å¾‹äº‹å‹™æ‰€' }]
  },
  baby: {
    title: 'å‡ºç”£ãƒ»è‚²å…ã§æ‰‹ãŒå›ã‚‰ãªã„',
    items: ['ãƒšãƒƒãƒˆã‚·ãƒƒã‚¿ãƒ¼ã‚’åˆ©ç”¨ã™ã‚‹','å®¶æ—ã‚„å‹äººã«ä¸€æ™‚çš„ã«æ‰‹ä¼ã£ã¦ã‚‚ã‚‰ã†','è‚²å…ãŒè½ã¡ç€ãã¾ã§ä¸€æ™‚é ã‹ã‚Šã‚’åˆ©ç”¨ã™ã‚‹','ç”Ÿæ´»ãƒªã‚ºãƒ ã‚’è¦‹ç›´ã—ã¦ãƒšãƒƒãƒˆã®æ™‚é–“ã‚’ç¢ºä¿ã™ã‚‹'],
    orgs: [{ name: 'ãƒšãƒƒãƒˆã‚·ãƒƒã‚¿ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆæ¤œç´¢ï¼‰', url: 'https://www.google.com/search?q=ãƒšãƒƒãƒˆã‚·ãƒƒã‚¿ãƒ¼+è¿‘ã' }, { name: 'å‹•ç‰©æ„›è­·å¸‚æ°‘å›£ä½“JCDLï¼ˆä¸€æ™‚é ã‹ã‚Šï¼‰', url: 'https://jcdl.jp' }]
  },
  different: {
    title: 'æ€ã£ã¦ã„ãŸé£¼è‚²ã¨é•ã£ãŸ',
    items: ['ãƒ‰ãƒƒã‚°ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã‚„å°‚é–€å®¶ã«ç›¸è«‡ã™ã‚‹','ã—ã¤ã‘æ•™å®¤ã«é€šã†','å•é¡Œè¡Œå‹•ã®åŸå› ã‚’ç†è§£ã—ã¦å¯¾å‡¦æ³•ã‚’å­¦ã¶','ã©ã†ã—ã¦ã‚‚ç„¡ç†ãªå ´åˆã¯è²¬ä»»ã‚ã‚‹è­²æ¸¡å…ˆã‚’æ¢ã™'],
    orgs: [{ name: 'ãƒ‰ãƒƒã‚°ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ï¼ˆæ¤œç´¢ï¼‰', url: 'https://www.google.com/search?q=ãƒ‰ãƒƒã‚°ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼+è¿‘ã' }, { name: 'æ—¥æœ¬å‹•ç‰©æ„›è­·å”ä¼š', url: 'https://jspca.or.jp' }, { name: 'ãƒšãƒƒãƒˆã®ãŠã†ã¡ï¼ˆé‡Œè¦ªï¼‰', url: 'https://www.pet-home.jp' }]
  },
  other: {
    title: 'ãã®ä»–ã®ã”ç›¸è«‡',
    items: ['ã¾ãšã¯å‹•ç‰©æ„›è­·å›£ä½“ã¸ç›¸è«‡ã™ã‚‹','ç£åŒ»å¸«ã‚„å°‚é–€å®¶ã¸ç›¸è«‡ã™ã‚‹','åœ°åŸŸã®å‹•ç‰©æ„›è­·ã‚»ãƒ³ã‚¿ãƒ¼ã¸å•ã„åˆã‚ã›ã‚‹','ã‚¿ã‚¹ã‚­ã®ã‚µãƒãƒ¼ãƒˆæƒ…å ±ã‚’ç¢ºèªã™ã‚‹'],
    orgs: [{ name: 'æ—¥æœ¬å‹•ç‰©æ„›è­·å”ä¼š', url: 'https://jspca.or.jp' }, { name: 'å‹•ç‰©æ„›è­·å¸‚æ°‘å›£ä½“JCDL', url: 'https://jcdl.jp' }]
  }
};

// Page switching
function switchPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.getElementById('nav-' + page).classList.add('active');
  state.currentPage = page;
  if (page === 'home') updateHome();
  if (page === 'health') { updateHealthTimeline(); initChart(); }
  if (page === 'support') calcSim();
}

function switchSubTab(page, tab) {
  const prefix = page + '-sub-';
  document.querySelectorAll(`[id^="${prefix}"]`).forEach(p => p.classList.remove('active'));
  document.getElementById(prefix + tab).classList.add('active');
  const tabs = document.querySelectorAll(`#page-${page} .sub-tab`);
  tabs.forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  if (tab === 'graph') { setTimeout(initChart, 100); }
}

// Show SOS Solution
function showSolution(key) {
  const sol = solutions[key];
  const area = document.getElementById('solution-area');
  area.innerHTML = `
    <div style="background:var(--white);border:1px solid var(--border);border-radius:16px;padding:16px;margin-top:12px">
      <div style="font-size:16px;font-weight:700;margin-bottom:12px;color:var(--text)">ğŸ“‹ ${sol.title}</div>
      <div style="font-size:13px;font-weight:700;margin-bottom:8px">å…·ä½“çš„ãªè§£æ±ºç­–</div>
      ${sol.items.map((item, i) => `
        <div class="solution-item">
          <div class="solution-num">${i+1}</div>
          <div>${item}</div>
        </div>
      `).join('')}
      <div class="org-list">
        <div class="org-title">ç›¸è«‡å…ˆãƒ»æ”¯æ´å›£ä½“</div>
        ${sol.orgs.map(org => `
          <div class="org-item">
            <div class="org-name">${org.name}</div>
            <a class="org-link" href="${org.url}" target="_blank">ğŸŒ è©³ã—ãè¦‹ã‚‹ â†’</a>
          </div>
        `).join('')}
      </div>
      <div class="action-btns">
        <button class="action-btn" onclick="switchPage('note')">ğŸ“– ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆã‚’æ›¸ã</button>
        <button class="action-btn" onclick="switchPage('support')">ğŸ” æ”¯æ´ã‚’æ¢ã™</button>
      </div>
    </div>
  `;
  area.scrollIntoView({ behavior: 'smooth' });
}

// Pet Profile
function savePetProfile() {
  const profile = {
    name: document.getElementById('pet-name').value,
    species: document.getElementById('pet-species').value,
    breed: document.getElementById('pet-breed').value,
    age: document.getElementById('pet-age').value,
    gender: document.getElementById('pet-gender').value,
    personality: document.getElementById('pet-personality').value,
    food: document.getElementById('pet-food').value,
    fears: document.getElementById('pet-fears').value,
    medical: document.getElementById('pet-medical').value,
    meds: document.getElementById('pet-meds').value,
    chip: document.getElementById('pet-chip').value,
    vet: document.getElementById('pet-vet').value,
    photo: state.petProfile?.photo || null
  };
  localStorage.setItem('tasuki-pet', JSON.stringify(profile));
  state.petProfile = profile;
  alert('âœ… ãƒšãƒƒãƒˆæƒ…å ±ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
  updateHome();
}

function setPetPhoto(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    document.getElementById('pet-avatar-display').innerHTML = `<img src="${ev.target.result}" style="width:80px;height:80px;object-fit:cover;border-radius:50%">`;
    if (!state.petProfile) state.petProfile = {};
    state.petProfile.photo = ev.target.result;
  };
  reader.readAsDataURL(file);
}

function updateHome() {
  const p = state.petProfile;
  const summaryEl = document.getElementById('pet-summary-content');
  if (p && p.name) {
    summaryEl.innerHTML = `
      <div style="display:flex;align-items:center;gap:12px">
        <div style="width:50px;height:50px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;font-size:24px;border:2px solid var(--primary);overflow:hidden;flex-shrink:0">
          ${p.photo ? `<img src="${p.photo}" style="width:100%;height:100%;object-fit:cover">` : 'ğŸ¶'}
        </div>
        <div>
          <div style="font-weight:700;font-size:16px">${p.name}</div>
          <div style="font-size:12px;color:var(--text-light)">${p.breed || ''} ${p.age ? p.age + 'æ­³' : ''}</div>
        </div>
      </div>
    `;
  }
  updateAlerts();
}

function updateAlerts() {
  const alertArea = document.getElementById('alert-area');
  alertArea.innerHTML = '';
  // Check vaccine alerts from localStorage
  const vaccines = JSON.parse(localStorage.getItem('tasuki-vaccines') || '[]');
  const today = new Date();
  vaccines.forEach(v => {
    if (v.nextDate) {
      const next = new Date(v.nextDate);
      const diff = Math.ceil((next - today) / (1000 * 60 * 60 * 24));
      if (diff <= 7 && diff >= 0) {
        alertArea.innerHTML += `<div class="alert-banner">âš ï¸ ${v.name}ã®æ¥ç¨®ãŒ${diff === 0 ? 'ä»Šæ—¥' : diff + 'æ—¥å¾Œ'}ã§ã™</div>`;
      }
    }
  });
}

// Health Records
function openHealthModal() {
  state.selectedOpts = { appetite: '', activity: '', stool: '' };
  document.getElementById('h-weight').value = '';
  document.getElementById('h-memo').value = '';
  document.getElementById('health-photo-preview').innerHTML = '';
  document.querySelectorAll('.icon-opt').forEach(o => o.classList.remove('selected'));
  document.getElementById('health-modal').classList.add('active');
}

function closeModal(id) {
  document.getElementById(id).classList.remove('active');
}

function selectOpt(el, type, val) {
  el.closest('.icon-selector').querySelectorAll('.icon-opt').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
  state.selectedOpts[type] = val;
}

function previewHealthPhotos(e) {
  const preview = document.getElementById('health-photo-preview');
  preview.innerHTML = '';
  Array.from(e.target.files).slice(0, 3).forEach(file => {
    const reader = new FileReader();
    reader.onload = (ev) => {
      const img = document.createElement('img');
      img.src = ev.target.result;
      img.className = 'photo-thumb';
      preview.appendChild(img);
    };
    reader.readAsDataURL(file);
  });
}

function saveHealthRecord() {
  const weight = parseFloat(document.getElementById('h-weight').value);
  const memo = document.getElementById('h-memo').value;
  const photos = Array.from(document.getElementById('health-photo-preview').querySelectorAll('img')).map(i => i.src);

  const record = {
    date: new Date().toISOString(),
    weight: weight || null,
    appetite: state.selectedOpts.appetite,
    activity: state.selectedOpts.activity,
    stool: state.selectedOpts.stool,
    memo,
    photos
  };

  state.healthRecords.unshift(record);
  localStorage.setItem('tasuki-health', JSON.stringify(state.healthRecords));

  // Check weight alert
  if (state.healthRecords.length >= 2 && weight) {
    const prev = state.healthRecords[1].weight;
    if (prev) {
      const change = Math.abs((weight - prev) / prev * 100);
      if (change >= 3) {
        setTimeout(() => alert('âš ï¸ ä½“é‡ãŒå‰å›æ¯”' + change.toFixed(1) + '%å¤‰åŒ–ã—ã¦ã„ã¾ã™ã€‚ç£åŒ»ã¸ã®ç›¸è«‡ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚'), 300);
      }
    }
  }

  closeModal('health-modal');
  updateHealthTimeline();
  if (state.weightChart) initChart();
}

function updateHealthTimeline() {
  const container = document.getElementById('health-timeline');
  if (state.healthRecords.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“‹</div><p>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“<br>ä»Šæ—¥ã®è¨˜éŒ²ã‚’ã¤ã‘ã¾ã—ã‚‡ã†</p></div>`;
    return;
  }

  const appetiteLabel = { good: 'ğŸ˜‹ é£Ÿæ¬²è‰¯å¥½', normal: 'ğŸ˜ é£Ÿæ¬²æ™®é€š', bad: 'ğŸ˜ é£Ÿæ¬²ä¸æŒ¯' };
  const activityLabel = { good: 'ğŸƒ æ´»ç™º', normal: 'ğŸš¶ æ™®é€š', bad: 'ğŸ˜´ æ´»å‹•å°‘' };
  const stoolLabel = { good: 'âœ… ä¾¿è‰¯å¥½', soft: 'âš ï¸ è»Ÿä¾¿', bad: 'ğŸš¨ ä¸‹ç—¢' };

  container.innerHTML = state.healthRecords.slice(0, 10).map((r, i) => {
    const prev = state.healthRecords[i + 1];
    let weightChange = '';
    if (r.weight && prev && prev.weight) {
      const diff = r.weight - prev.weight;
      if (diff > 0) weightChange = `<span class="weight-change up">â–²${diff.toFixed(1)}kg</span>`;
      else if (diff < 0) weightChange = `<span class="weight-change down">â–¼${Math.abs(diff).toFixed(1)}kg</span>`;
      else weightChange = `<span class="weight-change same">å¤‰åŒ–ãªã—</span>`;
    }

    return `
      <div class="timeline-item">
        <div class="timeline-date">${new Date(r.date).toLocaleDateString('ja-JP')}</div>
        ${r.weight ? `<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><span class="weight-display">${r.weight}kg</span>${weightChange}</div>` : ''}
        <div class="health-icons">
          ${r.appetite ? `<span class="health-badge">${appetiteLabel[r.appetite]}</span>` : ''}
          ${r.activity ? `<span class="health-badge">${activityLabel[r.activity]}</span>` : ''}
          ${r.stool ? `<span class="health-badge">${stoolLabel[r.stool]}</span>` : ''}
        </div>
        ${r.photos && r.photos.length > 0 ? `<div class="photo-preview">${r.photos.map(p => `<img src="${p}" class="photo-thumb">`).join('')}</div>` : ''}
        ${r.memo ? `<div style="font-size:12px;color:var(--text-light);margin-top:6px">ğŸ“ ${r.memo}</div>` : ''}
      </div>
    `;
  }).join('');
}

// Chart
function initChart() {
  const records = state.healthRecords.filter(r => r.weight).slice(0, state.chartRange).reverse();
  const labels = records.map(r => new Date(r.date).toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' }));
  const data = records.map(r => r.weight);

  const ctx = document.getElementById('weightChart');
  if (!ctx) return;

  if (state.weightChart) state.weightChart.destroy();

  const avgWeight = data.length > 0 ? data.reduce((a, b) => a + b, 0) / data.length : 5;

  state.weightChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels.length > 0 ? labels : ['è¨˜éŒ²ãªã—'],
      datasets: [
        {
          label: 'ä½“é‡(kg)',
          data: data.length > 0 ? data : [0],
          borderColor: '#E8845A',
          backgroundColor: 'rgba(232,132,90,0.1)',
          borderWidth: 2,
          pointBackgroundColor: '#E8845A',
          tension: 0.3,
          fill: true
        },
        {
          label: 'ç†æƒ³ä½“é‡',
          data: labels.map(() => avgWeight),
          borderColor: '#8B6F5E',
          borderWidth: 1,
          borderDash: [5, 5],
          pointRadius: 0
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: {
        y: { beginAtZero: false, grid: { color: '#EDD9C8' } },
        x: { grid: { display: false } }
      }
    }
  });
}

function switchChartRange(range, el) {
  state.chartRange = range;
  document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  initChart();
}

// Vaccine Modal
function openVaccineModal() {
  const name = prompt('ãƒ¯ã‚¯ãƒãƒ³åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šæ··åˆãƒ¯ã‚¯ãƒãƒ³5ç¨®ï¼‰');
  if (!name) return;
  const nextDate = prompt('æ¬¡å›æ¥ç¨®äºˆå®šæ—¥ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼š2026-06-01ï¼‰');
  const vaccines = JSON.parse(localStorage.getItem('tasuki-vaccines') || '[]');
  vaccines.push({ name, nextDate });
  localStorage.setItem('tasuki-vaccines', JSON.stringify(vaccines));
  state.vaccines = vaccines;
  alert('âœ… ãƒ¯ã‚¯ãƒãƒ³æƒ…å ±ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
  updateAlerts();
}

function openMedModal() {
  const name = prompt('è–¬ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
  if (!name) return;
  const dosage = prompt('ç”¨é‡ãƒ»æœç”¨æ–¹æ³•ï¼ˆä¾‹ï¼š1æ—¥1å›1éŒ ï¼‰');
  const meds = JSON.parse(localStorage.getItem('tasuki-meds') || '[]');
  meds.push({ name, dosage });
  localStorage.setItem('tasuki-meds', JSON.stringify(meds));

  const medList = document.getElementById('med-list');
  medList.innerHTML = meds.map(m => `
    <div class="vaccine-item">
      <div>
        <div class="vaccine-name">${m.name}</div>
        <div class="vaccine-date">${m.dosage}</div>
      </div>
      <span class="vaccine-ok">æœç”¨ä¸­</span>
    </div>
  `).join('');
}

// Tasuki Note
function saveNote() {
  const note = {
    message: document.getElementById('note-message').value,
    nextOwner: document.getElementById('note-next-owner').value,
    nextContact: document.getElementById('note-next-contact').value,
    nextRelation: document.getElementById('note-next-relation').value,
    feeding: document.getElementById('note-feeding').value,
    walk: document.getElementById('note-walk').value,
    caution: document.getElementById('note-caution').value,
    costFood: document.getElementById('note-cost-food').value,
    costMedical: document.getElementById('note-cost-medical').value,
    costOther: document.getElementById('note-cost-other').value
  };
  localStorage.setItem('tasuki-note', JSON.stringify(note));
  alert('âœ… ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ');
}

function shareNote() {
  if (navigator.share) {
    navigator.share({ title: 'Tasuki ã‚¿ã‚¹ã‚­ãƒãƒ¼ãƒˆ', text: 'ã‚‚ã—ã‚‚ã®æ™‚ã®ãŸã‚ã®ãƒšãƒƒãƒˆã‚±ã‚¢æƒ…å ±ã§ã™', url: window.location.href });
  } else {
    navigator.clipboard.writeText(window.location.href).then(() => alert('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚ä¿¡é ¼ã§ãã‚‹æ–¹ã«å…±æœ‰ã—ã¦ãã ã•ã„ã€‚'));
  }
}

// Support Filter
function filterSupport(cat, el) {
  document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  document.querySelectorAll('.support-card').forEach(card => {
    if (cat === 'all' || card.dataset.cat === cat) {
      card.style.display = 'block';
    } else {
      card.style.display = 'none';
    }
  });
}

// Simulator
function calcSim() {
  const species = document.getElementById('sim-species').value;
  const costs = {
    'dog-s': { food: 6000, medical: 6000, trim: 4000, insurance: 3000, supplies: 2000 },
    'dog-m': { food: 9000, medical: 8000, trim: 5000, insurance: 4000, supplies: 3000 },
    'dog-l': { food: 15000, medical: 10000, trim: 6000, insurance: 5000, supplies: 4000 },
    'cat': { food: 5000, medical: 5000, trim: 1000, insurance: 2500, supplies: 2000 }
  };
  const c = costs[species];
  const monthly = Object.values(c).reduce((a, b) => a + b, 0);
  const yearly = monthly * 12;
  const total = yearly * 10;

  document.getElementById('sim-monthly').textContent = 'Â¥' + monthly.toLocaleString();
  document.getElementById('sim-yearly').textContent = 'ç´„' + yearly.toLocaleString() + 'å††';
  document.getElementById('sim-total').textContent = 'ç´„' + total.toLocaleString() + 'å††';
  document.getElementById('sim-food').textContent = 'æœˆ' + c.food.toLocaleString() + 'å††';
  document.getElementById('sim-medical').textContent = 'æœˆ' + c.medical.toLocaleString() + 'å††';
  document.getElementById('sim-trim').textContent = 'æœˆ' + c.trim.toLocaleString() + 'å††';
  document.getElementById('sim-insurance').textContent = 'æœˆ' + c.insurance.toLocaleString() + 'å††';
  document.getElementById('sim-supplies').textContent = 'æœˆ' + c.supplies.toLocaleString() + 'å††';
}

// Checklist
function toggleCheck(el) {
  const box = el.querySelector('.check-box');
  box.classList.toggle('checked');
  box.innerHTML = box.classList.contains('checked') ? 'âœ“' : '';
  box.style.color = 'white';
  box.style.fontSize = '14px';
  box.style.fontWeight = '700';

  const total = document.querySelectorAll('.check-item').length;
  const done = document.querySelectorAll('.check-box.checked').length;
  const pct = (done / total) * 100;

  document.getElementById('check-progress').style.width = pct + '%';
  document.getElementById('check-count').textContent = done + ' / ' + total + ' å®Œäº†';

  if (done === total) {
    document.getElementById('check-result').style.display = 'block';
  } else {
    document.getElementById('check-result').style.display = 'none';
  }
}

// Load saved data
function loadSavedData() {
  const pet = state.petProfile;
  if (pet) {
    if (pet.name) document.getElementById('pet-name').value = pet.name;
    if (pet.species) document.getElementById('pet-species').value = pet.species;
    if (pet.breed) document.getElementById('pet-breed').value = pet.breed;
    if (pet.age) document.getElementById('pet-age').value = pet.age;
    if (pet.gender) document.getElementById('pet-gender').value = pet.gender;
    if (pet.personality) document.getElementById('pet-personality').value = pet.personality;
    if (pet.food) document.getElementById('pet-food').value = pet.food;
    if (pet.fears) document.getElementById('pet-fears').value = pet.fears;
    if (pet.medical) document.getElementById('pet-medical').value = pet.medical;
    if (pet.meds) document.getElementById('pet-meds').value = pet.meds;
    if (pet.chip) document.getElementById('pet-chip').value = pet.chip;
    if (pet.vet) document.getElementById('pet-vet').value = pet.vet;
    if (pet.photo) {
      document.getElementById('pet-avatar-display').innerHTML = `<img src="${pet.photo}" style="width:80px;height:80px;object-fit:cover;border-radius:50%">`;
    }
  }

  const note = state.note;
  if (note) {
    if (note.message) document.getElementById('note-message').value = note.message;
    if (note.nextOwner) document.getElementById('note-next-owner').value = note.nextOwner;
    if (note.nextContact) document.getElementById('note-next-contact').value = note.nextContact;
    if (note.nextRelation) document.getElementById('note-next-relation').value = note.nextRelation;
    if (note.feeding) document.getElementById('note-feeding').value = note.feeding;
    if (note.walk) document.getElementById('note-walk').value = note.walk;
    if (note.caution) document.getElementById('note-caution').value = note.caution;
    if (note.costFood) document.getElementById('note-cost-food').value = note.costFood;
    if (note.costMedical) document.getElementById('note-cost-medical').value = note.costMedical;
    if (note.costOther) document.getElementById('note-cost-other').value = note.costOther;
  }

  updateHome();
}

// Init
loadSavedData();
calcSim();
</script>
</body>
</html>
